<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN"><HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">
<META NAME="GENERATOR" CONTENT="Adobe FrameMaker 5.5/HTML Export Filter">
<LINK REL="STYLESHEET" HREF="draft-camarillo-sip-isup-bcp-00.css" CHARSET="ISO-8859-1" TYPE="text/css">
<TITLE>Best Current Practice for ISUP to SIP mapping</TITLE>
<META NAME="RFC" CONTENT="Internet Draft">
<META NAME="Title" CONTENT="BCP for SIP to ISUP Mapping">
<META NAME="Date" CONTENT="March 2000">
<META NAME="Last Name" CONTENT="Camarillo/Roach">

</HEAD>
<BODY BGCOLOR="#ffffff">
<DIV>
<TABLE NAME="Header" WIDTH=100%><TR><TD>Internet Engineering Task Force<BR>Internet Draft<BR>Category: Informational</TD><TD ALIGN=RIGHT>Gonzalo Camarillo/Adam Roach<BR>Ericsson<BR>March 2000<BR>Expires September 2000<BR>&lt;draft-camarillo-sip-isup-bcp-00.fm55&gt;</TD></TR></TABLE>
</DIV>
<DIV>
<H1 CLASS="Title">
<A NAME="pgfId-1029045"></A><A NAME="21178"></A>Best Current Practice for ISUP to SIP mapping</H1>
</DIV>
<DIV>
<H1 CLASS="Heading0">
<A NAME="pgfId-1029046"></A>Status of this Memo</H1>
<P CLASS="Body">
<A NAME="pgfId-1034424"></A>This document is an Internet-Draft and is in full conformance with all provisions of Section 10 of RFC2026.</P>
<P CLASS="Body">
<A NAME="pgfId-1034425"></A>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF), its areas, and its working groups. Note that other groups may also distribute working documents as Internet-Drafts.</P>
<P CLASS="Body">
<A NAME="pgfId-1034426"></A>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or cite them other than as &quot;work in progress&quot;.</P>
<P CLASS="Body">
<A NAME="pgfId-1034427"></A>The list of current Internet-Drafts can be accessed at http://www.ietf.org/ietf/lid-abstracts.txt</P>
<P CLASS="Body">
<A NAME="pgfId-1034428"></A>The list of Internet-Draft Shadow Directories can be accessed at http://www.ietf.org/shadow.html</P>
<P CLASS="Body">
<A NAME="pgfId-1034429"></A>This document is an individual submission to the IETF. Comments should be directed to the authors. </P>
</DIV>
<DIV>
<H1 CLASS="Heading0">
<A NAME="pgfId-998448"></A>Abstract</H1>
<P CLASS="Body">
<A NAME="pgfId-1029050"></A>This document describes a way to perform the mapping between two signalling protocols: SIP and ISUP.</P>
</DIV>
<DIV>
<H1 CLASS="Heading0">
<A NAME="pgfId-1033415"></A>Table of Contents</H1>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1029421"></A>1.	Introduction</H1>
<P CLASS="Body">
<A NAME="pgfId-1029422"></A>SIP <A HREF="draft-camarillo-sip-isup-bcp-00.html#53863" CLASS="XRef">[1]</A> is an application layer protocol for establishing, terminating and modifying multimedia sessions. It is typically carried over IP. Telephone calls are considered a type of multimedia sessions where just audio is exchanged.</P>
<P CLASS="Body">
<A NAME="pgfId-1029060"></A>ISUP <A HREF="draft-camarillo-sip-isup-bcp-00.html#65973" CLASS="XRef">[2]</A> is a level 4 protocol used in SS7 networks. It typically runs over MTP although it will run also over IP (work in progress, IETF SIGTRAN working group). ISUP is used for controlling telephone calls and for maintenance of the network (blocking circuits, resetting circuits etc.).</P>
<P CLASS="Body">
<A NAME="pgfId-1029061"></A>The module performing the mapping between these two protocols is usually referred to as Media Gateway Controller (MGC). It has logical interfaces towards both networks, the network carrying ISUP and the network carrying SIP, although usually they are on the same physical interface. The MGC also has capabilities for controlling the voice path. There is typically a Media Gateway (MG) with E1/T1 interfaces (voice from PSTN) and with IP interfaces (VoIP). The MGC and the MG can be merged together in one physical box or kept separate.</P>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1029095"></A>2.	Scope</H1>
<P CLASS="Body">
<A NAME="pgfId-1033421"></A>This document only takes into account the call functionality of ISUP. Maintenance messages dealing with PSTN trunks are treated only as far as they affect the control of an ongoing call.</P>
<P CLASS="Body">
<A NAME="pgfId-1036052"></A>Messages indicating error or congestion situations in the PSTN (MTP-3) and the recovery mechanisms used such as User Part Available and User Part Test ISUP messages are outside the scope of this document</P>
<P CLASS="Body">
<A NAME="pgfId-1029097"></A>There are several flavours of ISUP. ITU-T Q.767 International ISUP <A HREF="draft-camarillo-sip-isup-bcp-00.html#65973" CLASS="XRef">[2]</A> is used through this document and some differences with ANSI ISUP <A HREF="draft-camarillo-sip-isup-bcp-00.html#10269" CLASS="XRef">[3]</A> are outlined. ISUP Q.767 <A HREF="draft-camarillo-sip-isup-bcp-00.html#65973" CLASS="XRef">[2]</A> was chosen because is the least complex of all the ISUP flavours. Once the mapping between this flavour of ISUP and SIP is clear, mapping from other flavours to SIP will be easier to resolve.</P>
<P CLASS="Body">
<A NAME="pgfId-1029098"></A>This document describes when the media path has to be initialized, terminated, modified, etc., but it does not go into details such as how the initialization is performed or which protocols are used for that purpose.</P>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1029099"></A>3.	Scenarios</H1>
<P CLASS="Body">
<A NAME="pgfId-1029100"></A>There are several scenarios where ISUP-SIP mapping takes place. The way the messages are generated is different depending on the scenario.</P>
<P CLASS="Body">
<A NAME="pgfId-1029101"></A>When there is a single MGC and the call is from a SIP phone to a PSTN phone, or vice versa, the MGC generates the ISUP messages based on the methods described in this document.</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029790"></A>+-------------+       +-----+       +-------------+
| PSTN switch +-------+ MGC +-------+ SIP UAC/UAS |
+-------------+       +-----+       +-------------+</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1030145"></A>The scenario where a call originates in the PSTN, goes into a SIP network and terminates in the PSTN again is known as &quot;SIP bridging&quot;. SIP bridging should provide ISUP transparency between the PSTN switches handling the call. This is achieved by carrying the incoming ISUP messages in the body of the SIP messages <A HREF="draft-camarillo-sip-isup-bcp-00.html#93858" CLASS="XRef">[4]</A>. In this case, the ISUP messages generated by the egress MGC are the ones present in the SIP body (possibly with some modifications; for example, if the called number in the request URI is different from the one present in the ISUP due to SIP redirection, the ISUP message will need to be adjusted).</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029789"></A>+------+   +-------------+   +-----+   +------------+   +------+
| PSTN +---+ Ingress MGC +---+ SIP +---+ Egress MGC +---+ PSTN |
+------+   +-------------+   +-----+   +------------+   +------+</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1033454"></A>SIP is used in the middle of both MGCs because the voice path has to be established through the IP network between both MGs; this structure also allows the call to take advantage of certain SIP services. ISUP messages in the SIP bodies provide further information (such as cause values and optional parameters) to the peer MGC.</P>
<P CLASS="Body">
<A NAME="pgfId-1033455"></A>In both scenarios, the ingress MGC places the incoming ISUP messages in the SIP body by default. Note that this has security implications; see section <A HREF="draft-camarillo-sip-isup-bcp-00.html#66958" CLASS="XRef">15.</A> If the recipient of these messages (typically a SIP UAC/UAS) does not understand them a negotiation using the SIP `Accept' and `Require' headers will take place and they will not be included in the next SIP message exchange.</P>
<P CLASS="Body">
<A NAME="pgfId-1029106"></A>There can be a Signalling Gateway (SG) between the PSTN and the MGC. It encapsulates the ISUP messages over IP. The mapping described in this document is not affected by its presence.</P>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1029107"></A>4.	Extensions Required</H1>
<P CLASS="Body">
<A NAME="pgfId-1029108"></A>For a correct mapping between ISUP and SIP, some extensions to the basic SIP specification are needed. These extensions are discussed below. If the SIP UAC/UAS involved in the call does not support them, it is still possible to proceed, but the behavior in the establishment of the call may be slightly different than that expected by the user (e.g. other party answers before receiving the ringback tone, user is not informed about the call being forwarded, etc.).</P>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1034435"></A>4.1.	&quot;Transparent&quot; Transit of ISUP messages</H2>
<P CLASS="Body">
<A NAME="pgfId-1034436"></A>To provide users the ability to take advantage of the full range of services afforded by the existing telephone network when placing calls from PSTN to PSTN across a SIP network, SIP messages will need to carry ISUP payloads from gateway to gateway. The format for carrying these messages  is defined in &quot;MIME media types for ISUP and QSIG Objects&quot; <A HREF="draft-camarillo-sip-isup-bcp-00.html#93858" CLASS="XRef">[4]</A>.</P>
<P CLASS="Body">
<A NAME="pgfId-1034544"></A>SIP clients and servers which do not understand ISUP are encouraged to recognize this MIME type and ignore it.</P>
</DIV>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1034446"></A>4.2.	Understanding of Multipart Bodies</H2>
<P CLASS="Body">
<A NAME="pgfId-1034447"></A>In most PSTN interworking situations, the SIP body will be required to carry session information in addition to ISUP and/or billing information. </P>
<P CLASS="Body">
<A NAME="pgfId-1034448"></A>PSTN interworking nodes should understand the MIME type of &quot;multipart/mixed&quot; as defined in RFC2046 <A HREF="draft-camarillo-sip-isup-bcp-00.html#83366" CLASS="XRef">[5]</A>. Clients express support for this by including &quot;multipart/mixed&quot; in an &quot;Accept&quot; header.</P>
</DIV>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1034450"></A>4.3.	Transmission of DTMF information</H2>
<P CLASS="Body">
<A NAME="pgfId-1034451"></A>Since the codec selected for voice transmission may not be ideally suited for carrying DTMF information, a symbolic method of transmitting this information in-band is desirable (since out-of-band transmission alone would provide many challenges for syncronization of the media stream for tone re-insertion). This transmission will be performed as described in &quot;RTP Payload for DTMF Digits, Telephony Tones and Telephony Signals&quot; <A HREF="draft-camarillo-sip-isup-bcp-00.html#82742" CLASS="XRef">[6]</A>.</P>
<P CLASS="Body">
<A NAME="pgfId-1034452"></A>In addition to the need to faithfully carry telephony tones across the audio channel, PSTN interworking situations will require the capability on the part of SIP nodes to collect further digits from the end user. This may be used, for example, to provide authentication information to a SIP node via DTMF without the SIP node needing to process the media stream. This transit is accomplished using the method described in section 2.1 of &quot;Sample Uses of SIP INFO with Varying Reliability Needs&quot; <A HREF="draft-camarillo-sip-isup-bcp-00.html#77832" CLASS="XRef">[7]</A>.</P>
</DIV>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1034456"></A>4.4.	Reliable Transmission of Provisional Responses</H2>
<P CLASS="Body">
<A NAME="pgfId-1034458"></A>Provisional responses are used to transmission of various progress information. PSTN interworking in particular relies on these messages for control of the media channel and timing of messages.</P>
<P CLASS="Body">
<A NAME="pgfId-1034634"></A>PSTN interoperation nodes should implement the extension defined in &quot;Reliability of Provisional Responses in SIP&quot; <A HREF="draft-camarillo-sip-isup-bcp-00.html#93140" CLASS="XRef">[8]</A>.</P>
</DIV>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1034463"></A>4.5.	Provisional Media Streams</H2>
<P CLASS="Body">
<A NAME="pgfId-1034464"></A>To allow the transmission of messages and tones before a final connection has been established, SIP nodes which interwork with the PSTN need to be able to establish temporary media connections during this period.</P>
<P CLASS="Body">
<A NAME="pgfId-1034465"></A>PSTN interoperating nodes should support the establishement of temporary provisional media streams, as specified in &quot;SIP 183 Session Progress Message&quot; <A HREF="draft-camarillo-sip-isup-bcp-00.html#91880" CLASS="XRef">[9]</A>.</P>
</DIV>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1034473"></A>4.6.	Mid-Call Transactions Which do not Change SIP State</H2>
<P CLASS="Body">
<A NAME="pgfId-1034474"></A>When interworking with PSTN, there are situations when PSTN nodes will need to send messages which do not correspond to any SIP operations to each other across a SIP network.</P>
<P CLASS="Body">
<A NAME="pgfId-1034671"></A>The method for performing this transit will be in the INFO method, defined in &quot;The SIP INFO Method&quot; <A HREF="draft-camarillo-sip-isup-bcp-00.html#54270" CLASS="XRef">[10]</A>.</P>
<P CLASS="Body">
<A NAME="pgfId-1034477"></A>Nodes which do serve as PSTN interworking points should accept &quot;405 Method Not Allowed&quot; and &quot;501 Not Implemented&quot; responses to INFO requests as non-fatal.</P>
</DIV>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1029109"></A>5.	Mapping</H1>
<P CLASS="Body">
<A NAME="pgfId-1029110"></A>The mapping between ISUP and SIP is described using call flow diagrams and state machines. One state machine handles calls from SIP to ISUP and the second from ISUP to SIP. There are details, such as some retransmissions and some states (waiting for RLC, waiting for ACK etc.), that are not shown in the figures in order to make them easier to follow.</P>
<P CLASS="Body">
<A NAME="pgfId-1029111"></A>The boxes represent the different states of the gateway, and the arrows show changes in the state. The event that triggers the change in the state and the actions to take appear on the arrow: event / section describing the actions to take.</P>
<P CLASS="Body">
<A NAME="pgfId-1029112"></A>For example, `INVITE / 6.1' indicates that an INVITE request has been received by the gateway, and the procedure upon reception is described in the section 6.1 of this document.</P>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1029113"></A>6.	SIP to ISUP mapping</H1>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1030719"></A>6.1.	Call Flows</H2>
<P CLASS="Body">
<A NAME="pgfId-1032913"></A>The following call flows illustrate the order of messages in typical success and error cases when setting up a call initiated from the SIP network. &quot;100 Trying&quot; acknowledgements to INVITE requests are not explained, since their presence is optional.</P>
<P CLASS="Body">
<A NAME="pgfId-1034378"></A>In these diagrams, all call singnalling (SIP, ISUP) is going to and from the MGC; media handling (e.g. audio cut-through, trunk freeing) is being performed by the MG, under the control of the MGC. For the purpose of simplicity, these are shown as a single node, labeled &quot;MGC/MG.&quot;</P>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030725"></A>6.1.1.	En-bloc Call Setup (non auto-answer)</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1033859"></A>SIP                       MGC/MG                       PSTN
 1|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------IAM----------&gt;|2
  |                          |&lt;=========Audio===========|
  |                          |&lt;-----------ACM-----------|3
 4|&lt;----------18x------------|                          |
  |&lt;=========Audio===========|                          |
 5|----------PRACK----------&gt;|                          |
 6|&lt;----------200------------|                          |
  |                          |&lt;-----------CPG-----------|7
 8|&lt;----------18x------------|                          |
 9|----------PRACK----------&gt;|                          |
10|&lt;----------200------------|                          |
  |                          |&lt;-----------ANM-----------|11
  |                          |&lt;=========Audio==========&gt;|
12|&lt;----------200------------|                          |
  |&lt;=========Audio==========&gt;|                          |
13|-----------ACK-----------&gt;|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1031616"></A>(1)	When a SIP user wishes to begin a session with a PSTN user, the SIP node issues an INVITE request.</P>
<P CLASS="Step">
<A NAME="pgfId-1031617"></A>(2)	Upon receipt of an INVITE request, the gateway maps it to an IAM message and sends it to the ISUP network.</P>
<P CLASS="Step">
<A NAME="pgfId-1031618"></A>(3)	The remote ISUP node indicates that the address is sufficient to set up a call by sending back an ACM message.</P>
<P CLASS="Step">
<A NAME="pgfId-1033870"></A>(4)	The &quot;called party status&quot; code in the ACM message is mapped to a SIP provisional response (180 for &quot;subscriber free&quot; and 183 for &quot;no indication&quot;) and returned to the SIP node. This response may contain SDP to establish an early media stream (as shown in the diagram). If no SDP is present, the audio will be established in both directions after step 12.</P>
<P CLASS="Step">
<A NAME="pgfId-1033871"></A>(5)	The SIP node sends a PRACK message  to confirm receipt of the provisional response.</P>
<P CLASS="Step">
<A NAME="pgfId-1031648"></A>(6)	The PRACK is confirmed</P>
<P CLASS="Step">
<A NAME="pgfId-1031647"></A>(7)	The remote ISUP node may issue a variety of CPG messages to indicate, for example, that the call is being forwarded.</P>
<P CLASS="Step">
<A NAME="pgfId-1031622"></A>(8)	Upon receipt of a CPG message, the gateway will map the event code to a SIP provisional response (see section <A HREF="draft-camarillo-sip-isup-bcp-00.html#70829" CLASS="XRef">6.2.6.</A>) and send it to the SIP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1031653"></A>(9)	The SIP node sends a PRACK message  to confirm receipt of the provisional response.</P>
<P CLASS="Step">
<A NAME="pgfId-1031654"></A>(10)	The PRACK is confirmed</P>
<P CLASS="Step">
<A NAME="pgfId-1031624"></A>(11)	Once the PSTN user answers, an ANM message will be sent to the gateway. </P>
<P CLASS="Step">
<A NAME="pgfId-1031661"></A>(12)	Upon receipt of the ANM, the gateway will send a 200 message to the SIP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1031626"></A>(13)	The SIP node, upon receiving an INVITE final response (200), will send an ACK to acknowledge receipt.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1032297"></A>6.1.2.	<A NAME="80239"></A>Overlap Call Setup</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1032303"></A>SIP                       MGC/MG                       PSTN
 1|---------INVITE----------&gt;|                          |
 2|&lt;----------484------------|                          |
 3|-----------ACK-----------&gt;|                          |
 4|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------IAM----------&gt;|5
  |                          |&lt;=========Audio===========|
 6|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------SAM----------&gt;|7
 8|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------SAM----------&gt;|9
10|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------SAM----------&gt;|11
  |                          |&lt;-----------ACM-----------|12
13|&lt;----------180------------|                          |
  |&lt;=========Audio===========|                          |
14|&lt;----------484------------|                          |
15|&lt;----------484------------|                          |
16|&lt;----------484------------|                          |
17|----------PRACK----------&gt;|                          |
18|&lt;----------200------------|                          |
19|-----------ACK-----------&gt;|                          |
20|-----------ACK-----------&gt;|                          |
21|-----------ACK-----------&gt;|                          |
  |                          |&lt;-----------ANM-----------|22
  |                          |&lt;=========Audio==========&gt;|
23|&lt;----------200------------|                          |
  |&lt;=========Audio==========&gt;|                          |
24|-----------ACK-----------&gt;|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1032298"></A>(1)	When a SIP user wishes to begin a session with a PSTN user, the SIP node issues an INVITE request.</P>
<P CLASS="Step">
<A NAME="pgfId-1032272"></A>(2)	The gateway may be able to determine that the number in the SIP message is not long enough to set up a call (for example; it may not have enough of a number to know what PSTN node to route to). Under these circumstances, it will immediately return a &quot;484 Address Incomplete&quot; message.</P>
<P CLASS="Step">
<A NAME="pgfId-1032281"></A>(3)	The 484 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1032282"></A>(4)	After collecting more digits, the SIP node sends another INVITE. This invite contains the same &quot;From&quot; and &quot;Call-ID&quot; headers. The &quot;To&quot; field is updated to reflect the entire called number as known so far. Since the &quot;To&quot; field is different, this transaction represents a different call leg than the INVITE in step 1; consequently, there is no relationship between the CSeq values in the two INVITE messages. Note that the gateway may drop state knowledge between steps 3 and 4 unless ISUP tunnelling is being performed. (For ISUP tunneling, the IAM present in the initial INVITE will need to be reserved for step 5).</P>
<P CLASS="Step">
<A NAME="pgfId-1032283"></A>(5)	Once the gateway is not sure that the number is too short, it will send out the digits from the INVITE message as an IAM.</P>
<P CLASS="Step">
<A NAME="pgfId-1032284"></A>(6)	As more digits are collected, they will also be sent as INVITE messages. Note that the &quot;To&quot; field still contains the entire string of digits collected so far, not just the new ones.</P>
<P CLASS="Step">
<A NAME="pgfId-1032285"></A>(7)	The newly collected digits are sent to the PSTN as SAM messages.</P>
<P CLASS="Step">
<A NAME="pgfId-1032286"></A>(8)	See step 6</P>
<P CLASS="Step">
<A NAME="pgfId-1032287"></A>(9)	See step 7</P>
<P CLASS="Step">
<A NAME="pgfId-1032288"></A>(10)	See step 6</P>
<P CLASS="Step">
<A NAME="pgfId-1032289"></A>(11)	See step 7</P>
<P CLASS="Step">
<A NAME="pgfId-1032290"></A>(12)	Once the remote PSTN node receives enough digits, it will send an ACM message to indicate that it can now route the call.</P>
<P CLASS="Step">
<A NAME="pgfId-1032308"></A>(13)	The gateway sends a 180 message for the most recent pending transaction (or a 183 if the &quot;called party status&quot; field is marked &quot;no indication&quot;). The transaction to which this response belongs will be same as the INVITE which contains a complete phone number in its &quot;To&quot; field (the one sent in step 10).</P>
<P CLASS="Step">
<A NAME="pgfId-1032309"></A>(14)	&quot;484 Address Incomplete&quot; is sent to complete the INVITE transaction started in step 4.</P>
<P CLASS="Step">
<A NAME="pgfId-1032316"></A>(15)	&quot;484 Address Incomplete&quot; is sent to complete the INVITE transaction started in step 6.</P>
<P CLASS="Step">
<A NAME="pgfId-1032325"></A>(16)	&quot;484 Address Incomplete&quot; is sent to complete the INVITE transaction started in step 8.</P>
<P CLASS="Step">
<A NAME="pgfId-1032366"></A>(17)	The remote node sends a PRACK to acknowledge receipt of the 18x message sent in step 13.</P>
<P CLASS="Step">
<A NAME="pgfId-1032375"></A>(18)	The 484 from step 14 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1032379"></A>(19)	The 484 from step 15 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1032383"></A>(20)	The 484 from step 16 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1032388"></A>(21)	Once the PSTN user answers, an ANM message will be sent to the gateway. </P>
<P CLASS="Step">
<A NAME="pgfId-1032389"></A>(22)	Upon receipt of the ANM, the gateway will send a 200 message to the SIP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1032390"></A>(23)	The SIP node, upon receiving an INVITE final response (200), will send an ACK to acknowledge receipt.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1032175"></A>6.1.3.	<A NAME="78879"></A>Overlap call setup with a routing (redirect) server</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1032398"></A>SIP                    Routing Server                  PSTN
 1|---------INVITE----------&gt;|                          |
 2|&lt;----------484------------|                          |
 3|-----------ACK-----------&gt;|                          |
 4|---------INVITE----------&gt;|                          |
 5|&lt;----------484------------|                          |
 6|-----------ACK-----------&gt;|                          |
 7|---------INVITE----------&gt;|                          |
 8|&lt;----------302------------|                          |
 9|-----------ACK-----------&gt;|                          |
  |                                                     |
  |                                                     |
  |                       MGC/MG                        |
10|---------INVITE----------&gt;|                          |
              ...</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1032477"></A>(1)	When a SIP user wishes to begin a session with a PSTN user, the SIP node issues an INVITE request. In this example, the INVITE is sent to a server which knows how to select the egress gateway based on a numbering prefix.</P>
<P CLASS="Step">
<A NAME="pgfId-1032486"></A>(2)	Since the routing server doesn't have enough information to select an egress gateway, it responds with a &quot;484 Address Incomplete&quot;.</P>
<P CLASS="Step">
<A NAME="pgfId-1032487"></A>(3)	The 484 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1033915"></A>(4)	After collecting more digits, the SIP node sends another INVITE. This invite contains the same &quot;From&quot; and &quot;Call-ID&quot; headers. The &quot;To&quot; field is updated to reflect the entire called number as known so far. Since the &quot;To&quot; field is different, this transaction represents a different call leg than the INVITE in step 1; consequently, there is no relationship between the CSeq values in the two INVITE messages. Note that the routing server will probably drop state knowledge between steps 3 and 4.</P>
<P CLASS="Step">
<A NAME="pgfId-1033916"></A>(5)	In this example, there is still not enough information to route the call.</P>
<P CLASS="Step">
<A NAME="pgfId-1032460"></A>(6)	The 484 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1032465"></A>(7)	As in step 4, more digits are collected. While this INVITE contains enough information for the routing server to select a gateway, it is quite probable that the number is not yet complete.</P>
<P CLASS="Step">
<A NAME="pgfId-1032466"></A>(8)	A &quot;302 Temporarily Moved&quot; response is returned to redirect the SIP node to the appropriate gateway. (In practice, this may not necessarily be a gateway; it might be another redirect server, a proxy server, or a native client).</P>
<P CLASS="Step">
<A NAME="pgfId-1032467"></A>(9)	The 302 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1032468"></A>(10)	The call now continues as in step 1 of section <A HREF="draft-camarillo-sip-isup-bcp-00.html#80239" CLASS="XRef">6.1.2.</A></P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1032395"></A>6.1.4.	Auto-answer call setup</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1030808"></A>SIP                       MGC/MG                       PSTN
 1|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------IAM----------&gt;|2
  |                          |&lt;=========Audio===========|
  |                          |&lt;-----------CON-----------|3
  |                          |&lt;=========Audio==========&gt;|
 4|&lt;----------200------------|                          |
  |&lt;=========Audio==========&gt;|                          |
 5|-----------ACK-----------&gt;|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1031666"></A>(1)	When a SIP user wishes to begin a session with a PSTN user, the SIP node issues an INVITE request.</P>
<P CLASS="Step">
<A NAME="pgfId-1031667"></A>(2)	Upon receipt of an INVITE request, the gateway maps it to an IAM message and sends it to the ISUP network.</P>
<P CLASS="Step">
<A NAME="pgfId-1031668"></A>(3)	Since the remote node is configured for automatic answering, it will send a CON message upon receipt of the IAM. (For ANSI, this message will be an ANM).</P>
<P CLASS="Step">
<A NAME="pgfId-1031669"></A>(4)	Upon receipt of the ANM, the gateway will send a 200 message to the SIP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1031670"></A>(5)	The SIP node, upon receiving an INVITE final response (200), will send an ACK to acknowledge receipt.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030727"></A>6.1.5.	ISUP T7 expires</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1033949"></A>SIP                       MGC/MG                       PSTN
 1|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------IAM----------&gt;|2
  |                          |&lt;=========Audio===========|
  |                          |    *** T7 Expires ***    |
  |             ** MG Releases PSTN Trunk **            |
 4|&lt;----------504------------|------------REL----------&gt;|3
 5|-----------ACK-----------&gt;|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1031677"></A>(1)	When a SIP user wishes to begin a session with a PSTN user, the SIP node issues an INVITE request.</P>
<P CLASS="Step">
<A NAME="pgfId-1031678"></A>(2)	Upon receipt of an INVITE request, the gateway maps it to an IAM message and sends it to the ISUP network. The ISUP timer T7 is started at this point.</P>
<P CLASS="Step">
<A NAME="pgfId-1031679"></A>(3)	The ISUP timer T7 expires before receipt of an ACM or CON message, so a REL message is sent to cancel the call.</P>
<P CLASS="Step">
<A NAME="pgfId-1031680"></A>(4)	A gateway timeout message is sent back to the SIP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1031681"></A>(5)	The SIP node, upon receiving an INVITE final response (504), will send an ACK to acknowledge receipt.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030728"></A>6.1.6.	SIP Timeout</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1030852"></A>SIP                       MGC/MG                       PSTN
 1|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------IAM----------&gt;|2
  |                          |&lt;=========Audio===========|
  |                          |&lt;-----------CON-----------|3
  |                          |&lt;=========Audio==========&gt;|
 4|&lt;----------200------------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;----------200------------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;----------200------------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;----------200------------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;----------200------------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;----------200------------|                          |
  |    *** T1 Expires ***    |                          |
 5|&lt;----------200------------|                          |
  |    *** T1 Expires ***    |                          |
  |             ** MG Releases PSTN Trunk **            |
 7|&lt;----------BYE------------|------------REL----------&gt;|6
  |                          |&lt;-----------RLC-----------|8</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1031688"></A>(1)	When a SIP user wishes to begin a session with a PSTN user, the SIP node issues an INVITE request.</P>
<P CLASS="Step">
<A NAME="pgfId-1031689"></A>(2)	Upon receipt of an INVITE request, the gateway maps it to an IAM message and sends it to the ISUP network.</P>
<P CLASS="Step">
<A NAME="pgfId-1031690"></A>(3)	Since the remote node is configured for automatic answering, it will send a CON message upon receipt of the IAM.</P>
<P CLASS="Step">
<A NAME="pgfId-1031691"></A>(4)	Upon receipt of the ANM, the gateway will send a 200 message to the SIP node and set SIP timer T1.</P>
<P CLASS="Step">
<A NAME="pgfId-1031692"></A>(5)	The response is retransmitted every time the SIP timer T1 expires.</P>
<P CLASS="Step">
<A NAME="pgfId-1031693"></A>(6)	After seven retransmissions, the call is torn down by sending a REL to the ISUP node, with a cause code of 102 (recover on timer expiry).</P>
<P CLASS="Step">
<A NAME="pgfId-1031697"></A>(7)	A BYE is transmitted to the SIP node in an attempt to close the call. Further handling for this clean up is not shown, since the SIP node's state is not easily known in this scenario.</P>
<P CLASS="Step">
<A NAME="pgfId-1031698"></A>(8)	Upon receipt of the REL message, the remote ISUP node will reply with an RLC message.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030729"></A>6.1.7.	ISUP Setup Failure</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1034226"></A>SIP                       MGC/MG                       PSTN
 1|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------IAM----------&gt;|2
  |                          |&lt;-----------REL-----------|3
  |                          |------------RLC----------&gt;|4
 5|&lt;----------4xx+-----------|                          |
 6|-----------ACK-----------&gt;|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1031709"></A>(1)	When a SIP user wishes to begin a session with a PSTN user, the SIP node issues an INVITE request.</P>
<P CLASS="Step">
<A NAME="pgfId-1031710"></A>(2)	Upon receipt of an INVITE request, the gateway maps it to an IAM message and sends it to the ISUP network.</P>
<P CLASS="Step">
<A NAME="pgfId-1032162"></A>(3)	Since the remote ISUP node is unable to complete the call, it will send a REL.</P>
<P CLASS="Step">
<A NAME="pgfId-1031722"></A>(4)	The gateway releases the circuit and confirms that it is available for reuse by sending an RLC.</P>
<P CLASS="Step">
<A NAME="pgfId-1031715"></A>(5)	The gateway translates the cause code in the REL to a SIP error response (see section <A HREF="draft-camarillo-sip-isup-bcp-00.html#35882" CLASS="XRef">6.2.4.</A>) and sends it to the SIP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1031716"></A>(6)	The SIP node sends an ACK to acknowledge receipt of the INVITE final response.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030935"></A>6.1.8.	Cause present in ACM message</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1033982"></A>SIP                       MGC/MG                       PSTN
 1|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------IAM----------&gt;|2
  |                          |&lt;=========Audio===========|
  |                          |&lt;---ACM with cause code---|3
 4|&lt;------183 with SDP-------|                          |
  |&lt;=========Audio===========|                          |
 5|----------PRACK----------&gt;|                          |
 6|&lt;----------200------------|                          |
              ** Interwork timer expires **
 7|&lt;----------4xx+-----------|                          |
  |                          |------------REL----------&gt;|8
  |                          |&lt;-----------RLC-----------|9
10|-----------ACK-----------&gt;|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1031761"></A>(1)	When a SIP user wishes to begin a session with a PSTN user, the SIP node issues an INVITE request.</P>
<P CLASS="Step">
<A NAME="pgfId-1031762"></A>(2)	Upon receipt of an INVITE request, the gateway maps it to an IAM message and sends it to the ISUP network.</P>
<P CLASS="Step">
<A NAME="pgfId-1031763"></A>(3)	Since the ISUP node is unable to complete the call and wants to generate the error tone/announcement itself, it sends an ACM with a cause code. The gateway starts an interwork timer.</P>
<P CLASS="Step">
<A NAME="pgfId-1031764"></A>(4)	Upon receipt of an ACM with cause, the gateway will generate a 183  message towards the SIP node; this contains SDP to establish early media cut-through.</P>
<P CLASS="Step">
<A NAME="pgfId-1031789"></A>(5)	The SIP node sends a PRACK message  to confirm receipt of the provisional response.</P>
<P CLASS="Step">
<A NAME="pgfId-1031790"></A>(6)	The PRACK is confirmed</P>
<P CLASS="Step">
<A NAME="pgfId-1033275"></A>(7)	A final INVITE response, based on the cause code received in the earlier ACM message, is generated and sent to the SIP node to terminate the call. See section <A HREF="draft-camarillo-sip-isup-bcp-00.html#35882" CLASS="XRef">6.2.4.</A> for the table which contains the mapping from cause code to SIP response.</P>
<P CLASS="Step">
<A NAME="pgfId-1031766"></A>(8)	Upon expiration of the interwork timer, a REL is sent towards the SIP node to terminate the call. Note that the SIP node can also terminate the call by sending a CANCEL before the interwork timer expires. In this case, the signalling progresses as in section <A HREF="draft-camarillo-sip-isup-bcp-00.html#44686" CLASS="XRef">6.1.9.</A></P>
<P CLASS="Step">
<A NAME="pgfId-1031774"></A>(9)	Upon receipt of the REL message, the remote ISUP node will reply with an RLC message.</P>
<P CLASS="Step">
<A NAME="pgfId-1031775"></A>(10)	The SIP node sends an ACK to acknowledge receipt of the INVITE final response.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1031756"></A>6.1.9.	<A NAME="44686"></A>Call cancelled by SIP node</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1031890"></A>SIP                       MGC/MG                       PSTN
 1|---------INVITE----------&gt;|                          |
  |&lt;----------100------------|                          |
  |                          |------------IAM----------&gt;|2
  |                          |&lt;=========Audio===========|
  |                          |&lt;-----------ACM-----------|3
 4|&lt;----------18x------------|                          |
  |&lt;=========Audio===========|                          |
 5|----------PRACK----------&gt;|                          |
 6|&lt;----------200------------|                          |
  |            ** MG Releases IP Resources **           |
 7|----------CANCEL---------&gt;|                          |
 8|&lt;----------200------------|                          |
  |             ** MG Releases PSTN Trunk **            |
  |                          |------------REL----------&gt;|9
10|&lt;----------487------------|                          |
  |                          |&lt;-----------RLC-----------|11
12|-----------ACK-----------&gt;|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1031807"></A>(1)	When a SIP user wishes to begin a session with a PSTN user, the SIP node issues an INVITE request.</P>
<P CLASS="Step">
<A NAME="pgfId-1031808"></A>(2)	Upon receipt of an INVITE request, the gateway maps it to an IAM message and sends it to the ISUP network.</P>
<P CLASS="Step">
<A NAME="pgfId-1031809"></A>(3)	The remote ISUP node indicates that the address is sufficient to set up a call by sending back an ACM message.</P>
<P CLASS="Step">
<A NAME="pgfId-1033289"></A>(4)	The &quot;called party status&quot; code in the ACM message is mapped to a SIP provisional response (180 for &quot;subscriber free&quot; and 183 for &quot;no indication&quot;) and returned to the SIP node. This response may contain SDP to establish an early media stream.</P>
<P CLASS="Step">
<A NAME="pgfId-1031829"></A>(5)	The SIP node sends a PRACK message  to confirm receipt of the provisional response.</P>
<P CLASS="Step">
<A NAME="pgfId-1031830"></A>(6)	The PRACK is confirmed</P>
<P CLASS="Step">
<A NAME="pgfId-1031813"></A>(7)	To cancel the call before it is answered, the SIP node sends a CANCEL request.</P>
<P CLASS="Step">
<A NAME="pgfId-1031839"></A>(8)	The CANCEL request is confirmed with a 200 response.</P>
<P CLASS="Step">
<A NAME="pgfId-1031814"></A>(9)	Upon receipt of the CANCEL request, the gateway sends a REL message to terminate the ISUP call.</P>
<P CLASS="Step">
<A NAME="pgfId-1031848"></A>(10)	The gateway sends a &quot;487 Call Cancelled&quot; message to the SIP node to complete the INVITE transaction.</P>
<P CLASS="Step">
<A NAME="pgfId-1031815"></A>(11)	Upon receipt of the REL message, the remote ISUP node will reply with an RLC message.</P>
<P CLASS="Step">
<A NAME="pgfId-1031849"></A>(12)	Upon receipt of the 487, the SIP node will confirm reception with an ACK.</P>
</DIV>
</DIV>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1030720"></A>6.2.	State Machine</H2>
<P CLASS="Body">
<A NAME="pgfId-1033545"></A>Note that REL can be received in any state; the handling is the same for each case (see section <A HREF="draft-camarillo-sip-isup-bcp-00.html#35882" CLASS="XRef">6.2.4.</A>).</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1033667"></A>                              +---------+
     +-----------------------&gt;|  Idle   |&lt;---------------------+
     |                        +----+----+                      |
     |                             |                           |
     |                             | INVITE/6.2.1              |
     |                             V                           |
     |      T7/6.2.2   +-------------------------+   REL/6.2.4 |
     +&lt;----------------+         Trying          +------------&gt;+
     |                 +-+--------+------+-------+             |
     |    CANCEL/6.2.3 | |        |      |                     |
     +&lt;----------------+ | E.ACM/ | ACM/ | CON/                |
     |                   | 6.2.5  |6.2.6 | 6.2.7               |
     |                   V        |      |                     |
     | T9/6.2.8  +--------------+ |      |                     |
     +&lt;----------+ Not alerting | |      |                     |
     |           +-------+------+ |      |                     |
     |  CANCEL/6.2.3 |   |        |      |                     |
     |&lt;--------------+   | CPG/   |      |                     |
     |                   | 6.2.9  |      |                     |
     |                   V        V      |                     |
     |    T9/6.2.8     +---------------+ |    REL/6.2.4        |
     +&lt;----------------+    Alerting   |-|--------------------&gt;|
     |&lt;----------------+--+-----+------+ |                     |
     |  CANCEL/6.2.3      |  ^  |        |                     |
     |               CPG/ |  |  | ANM/   |                     |
     |              6.2.9 +--+  | 6.2.7  |                     |
     |                          V        V                     |
     |                 +-------------------------+    REL/9.2  |
     |                 |     Waiting for ACK     |------------&gt;|
     |                 +-------------+-----------+             |
     |                               |                         |
     |                               | ACK/6.2.10              |
     |                               V                         |
     |     BYE/9.1     +-------------------------+    REL/9.2  |
     +&lt;----------------+        Connected        +------------&gt;+
                       +-------------------------+</PRE>
</P>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1033550"></A>6.2.1.	INVITE received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029116"></A>When an INVITE request is received by the gateway, a &quot;100 Trying&quot; response may be sent back to the SIP network indicating that the MGC is handling the call.</P>
<P CLASS="Body">
<A NAME="pgfId-1033673"></A>The resources for the media stream have to be reserved at this stage, since an IAM message cannot be sent before the resource reservation takes place. Typically the resources consist of a time slot in an E1/T1 and an RTP/UDP port on the IP side. Resources might also include QoS or/and security provisions. Before sending the IAM the MG gets backward through connected.</P>
<P CLASS="Body">
<A NAME="pgfId-1029118"></A>An ISUP IAM is sent. If the incoming INVITE contains a IAM in its body this IAM is sent (possibly with certain changes; for example, the called number may need to be updated from the &quot;To&quot; field if the call was redirected inside the SIP network). If no IAM is present the MGC generates one. The mandatory parameters of the IAM are described below:</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029119"></A>&nbsp;</PRE>
<PRE CLASS="Preformat"><A NAME="pgfId-1029586"></A>Message type:                             IAM

Nature of connection indicators
Satellite Indicator:                    00 no satellite circuit
Continuity check indicator:             It depends on the call
                                        typically, 0 (no check)
Echo control device indicator:          It depends on the call

Forward call indicators
National/International call indicator:  It depends on the call
End-to-end method indicator:            00 no end-to-end method
Interworking indicator:                 0  no interworking
End-to-end information indicator        0  no end-to-end info
ISDN user part indicator:               1  ISUP all the way
ISDN user part preference indicator:    00 ISUP preferred
ISDN access indicator:                  1  ISDN access
SCCP method indicator:                  0  no indication

Calling party's category:               Depends on caller; usually
                                        00001010 ordinary

Transmission medium requirement:        It depends on the call

Called party's number:                  Based on the 'to' field</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1029125"></A>The optional parameter `Calling party number' can be added. Its value can be derived based on the SIP `from' header. Optionally, if this information cannot be verified, it may be sent as a `Generic Address Parameter.' Further, the gateway may choose to populate the `Original Called Number' (if it had to update the `Called Number' field) and the `Charge Number' field (based on a billing number obtained through means which are outside the scope of this document).</P>
<P CLASS="Body">
<A NAME="pgfId-1029126"></A>When the ISUP parameters regarding interworking are set, this indicates that ISDN is interworking with a network which is not capable of providing as many services as ISDN does. ISUP will therefore not employ certain features it otherwise normally uses. Thus, `interworking encountered' must not be specified so that ISUP behaves normally. SIP is considered as an SS7 network and a SIP phone is considered as ISDN access since the SIP network is supposed to provide at least as many services as ISUP.</P>
<P CLASS="Body">
<A NAME="pgfId-1036090"></A>Claiming to be an ISDN node might make the callee request ISDN user to user services. Since user to user sevices 1 and 2 must be requested by the caller, they do not represent a problem <A HREF="draft-camarillo-sip-isup-bcp-00.html#15899" CLASS="XRef">[13]</A>. User to user service 3 can be requested by the callee also. In non-SIP bridging situations, the MGC should be capable of rejecting this service request.</P>
<P CLASS="Body">
<A NAME="pgfId-1036094"></A>After sending the IAM the timer T7 is started. The default value of T7 is between 20 and 30 seconds. The MGC goes to the `Trying' state.</P>
<P CLASS="Body">
<A NAME="pgfId-1029128"></A>When overlap signalling is used in SIP bridging situations, more INVITEs might arrive containing subsequent digits of the callees'  number. These INVITEs have the same Call-ID and From fields, but the To field contains more digits.</P>
<P CLASS="Body">
<A NAME="pgfId-1029132"></A>The MGC receives these digits and sends a SAM with the new digits and restarts T7 every time a new INVITE arrives. All the INVITEs but the last one containing all the digits are answered with 484 Address Incomplete. The reception of an ACM from the ISUP network confirms that the callees' address is complete.</P>
<P CLASS="Body">
<A NAME="pgfId-1032927"></A>See sections <A HREF="draft-camarillo-sip-isup-bcp-00.html#80239" CLASS="XRef">6.1.2.</A> and <A HREF="draft-camarillo-sip-isup-bcp-00.html#50372" CLASS="XRef">7.1.2.</A> for a more detailed handling of overlapped dialing.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029133"></A>6.2.2.	ISUP T7 expires</H3>
<P CLASS="Body">
<A NAME="pgfId-1029134"></A>Since no response was received from the PSTN all the resources in the MG are released. A `408 request timeout' is sent back to the SIP network. A REL message with cause value 111 (protocol error) is sent to the PSTN. The PSTN responds with RLC and the SIP network responds with an ACK indicating that the release sequence has been completed.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029135"></A>6.2.3.	<A NAME="26873"></A>CANCEL or BYE received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029136"></A>If a CANCEL or BYE request is received, a `200 OK' is sent to the SIP network to confirm the CANCEL or BYE; a 487 is also sent to terminate the INVITE transaction. All the resources are released and a REL message is sent to the PSTN with cause value 16 (normal clearing). A RLC from the PSTN is received indicating that the release sequence is complete.</P>
<P CLASS="Body">
<A NAME="pgfId-1029137"></A>It is important that all the resources are released before the gateway sends any REL message.</P>
<P CLASS="Body">
<A NAME="pgfId-1029139"></A>In SIP bridging situations, a REL might arrive in the CANCEL or BYE request body. This REL is sent to the PSTN.</P>
<P CLASS="Body">
<A NAME="pgfId-1029140"></A>This section (<A HREF="draft-camarillo-sip-isup-bcp-00.html#26873" CLASS="XRef">6.2.3.</A>) applies every time that a CANCEL or a BYE is received before a final SIP response has been sent.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029345"></A>6.2.4.	<A NAME="35882"></A>REL received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029847"></A>This section applies every time that a REL is received before a final SIP response has been sent.</P>
<P CLASS="Body">
<A NAME="pgfId-1029856"></A>The resources are released in the MG and a RLC is sent to the ISUP network to indicate that the circuit is available for reuse.</P>
<P CLASS="Body">
<A NAME="pgfId-1029821"></A>If the INVITE originating this transaction contained ISUP messages in its body (IAM or SAMs), the MGC is handling a SIP bridging situation. Therefore, the REL message jut received should be included in the body of the  response.</P>
<P CLASS="Body">
<A NAME="pgfId-1029865"></A>The REL contains a cause value. The SIP response is sent based on this cause value. If a cause value other than what is listed below is received, the default response `500 Server internal error' would be used.</P>
<P CLASS="Body">
<A NAME="pgfId-1029825"></A>Normal event</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029639"></A>ISUP Cause value                        SIP response
----------------                        ------------
1  unallocated number                   410 Gone
2  no route to network                  404 Not found
3  no route to destination              404 Not found
4  send special information tone        ---
16 normal call clearing                 ---
17 user busy                            486 Busy here
18 no user responding                   480 Temporarily unavailable
19 no answer from the user              480 Temporarily unavailable
21 call rejected                        603 Decline
22 number changed                       301 Moved Permanently
27 destination out of order             404 Not found
28 address incomplete                   484 Address incomplete
29 facility rejected                    501 Not implemented
31 normal unspecified                   404 Not found</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1029795"></A>A REL with cause 22 (number changed) might contain information about a new number where the callee might be reachable. If the MGC is able to parse this information it might be added to the SIP response in a Contact header.</P>
<P CLASS="Body">
<A NAME="pgfId-1029149"></A>Resource unavailable</P>
<P CLASS="Body">
<A NAME="pgfId-1029150"></A>This kind of cause value indicates a non permanent situation. A `Retry-After' header has to be added to the response.</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029645"></A>ISUP Cause value                        SIP response
----------------                        ------------
34 no circuit available                 503 Service unavailable
38 network out of order                 503 Service unavailable
41 temporary failure                    503 Service unavailable
42 switching equipment congestion       503 Service unavailable
44 requested channel not available      503 Service unavailable
47 resource unavailable                 503 Service unavailable</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1029152"></A>Service or option not available</P>
<P CLASS="Body">
<A NAME="pgfId-1029153"></A>This kind of cause value indicates a permanent situation</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029657"></A>ISUP Cause value                        SIP response
----------------                        ------------
55 incoming calls bared within CUG      603 Decline
57 bearer capability not authorized     503 Service unavailable
58 bearer capability not presently      503 Service unavailable
   available
63 service/option not available         503 Service unavailable</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1029155"></A>Service or option not implemented</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029663"></A>ISUP Cause value                        SIP response
----------------                        ------------
65 bearer capability not implemented    501 Not implemented
79 service or option not implemented    501 Not implemented</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1029157"></A>Invalid message</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029673"></A>ISUP Cause value                        SIP response
----------------                        ------------
87 user not member of CUG               503 Service unavailable
88 incompatible destination             503 Service unavailable
95 invalid message                      503 Service unavailable</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1029159"></A>Protocol error</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029679"></A>ISUP Cause value                        SIP response
----------------                        ------------
102 recovery of timer expiry            408 Request timeout
111 protocol error                      500 Server internal error</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1029164"></A>Interworking</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029687"></A>ISUP Cause value                        SIP response
----------------                        ------------
127 interworking unspecified            500 Server internal error</PRE>
</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029172"></A>6.2.5.	Early ACM received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029173"></A>This message is sent in certain situations for resetting the timers. In these cases this message indicates that the call is in progress but callee is not being alerted. This occurs for example in mobile networks, where roaming can take a long time. The early ACM is sent before the user is alerted to reset T7 and start T9.</P>
<P CLASS="Body">
<A NAME="pgfId-1029174"></A>An ACM is considered an `early ACM' if the Called Party's Status Indicator is set to 00 (no indication).</P>
<P CLASS="Body">
<A NAME="pgfId-1029175"></A>After receiving an early ACM the progress of the call is indicated by the network sending CPGs.</P>
<P CLASS="Body">
<A NAME="pgfId-1029176"></A>When there is interworking with some old systems, it is possible to receive an ANM immediately after an early ACM (without CPG). In this situation the SIP user will not hear any kind of ringback tone before the callee answers. In ISDN <A HREF="draft-camarillo-sip-isup-bcp-00.html#58729" CLASS="XRef">[11]</A> this is solved by connecting the voice path backwards before sending the IAM.</P>
<P CLASS="Body">
<A NAME="pgfId-1029180"></A>The MGC sends a 183 Session Progress <A HREF="draft-camarillo-sip-isup-bcp-00.html#91880" CLASS="XRef">[9]</A> to the SIP network with a media description inside. In SIP bridging situations the early ACM is included in the response body. Thus, the problem of missing the ring back tone is solved and the early ACM is transported transparently through the SIP network.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029372"></A>6.2.6.	<A NAME="70829"></A>ACM received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029182"></A>Upon reception of an ACM timer T9 is started. T9 typically lasts between 90 seconds and 3 minutes <A HREF="draft-camarillo-sip-isup-bcp-00.html#79089" CLASS="XRef">[12]</A>. It allows the caller to hear announcements from the network for that period of time without being charged for the connection. If longer announcements have to be played the network has to send an ANM. When the ANM is sent the call begins being charged.</P>
<P CLASS="Body">
<A NAME="pgfId-1029183"></A>The nearest local exchange to the callee generates the ringback tone and may send voice announcements.</P>
<P CLASS="Body">
<A NAME="pgfId-1029184"></A>A `180 Ringing' is sent to the SIP network. It contains a media description. The ringback tone or the proper announcements will be generated by the PSTN exchange, and not by the callers SIP UAC/UAS.</P>
<P CLASS="Body">
<A NAME="pgfId-1029185"></A>In SIP bridging situations, the ACM is included in the body of the 180 response.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029375"></A>6.2.7.	CON or ANM received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029187"></A>A `200 OK' response is sent to the SIP network. In SIP bridging situations, the ISUP message  is included in the body of the 200 OK response. This is also the point at which a two-way media stream will be established.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1032972"></A>6.2.8.	Timer T9 expires</H3>
<P CLASS="Body">
<A NAME="pgfId-1032973"></A>This indicates that the ANM has not arrived in time specified. This results in the call being aborted. All the resources related to the media path are released. A `480 temporarily unavailable' is sent to the SIP network. A REL message with cause value 19 (no answer from the user) is sent to the ISUP part. The PSTN responds with RLC and the SIP network responds with an ACK indicating that the release sequence has been completed.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030714"></A>6.2.9.	CPG received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029198"></A>A CPG can indicate progress, alerting or in-band information. If the CPG comes after an ACM, there is already a one-way voice path open, so there is no need of taking further action in the media path.</P>
<P CLASS="Body">
<A NAME="pgfId-1029199"></A>In SIP bridging situations, the CPG is sent in the body of a 18x response, determined from the CPG event code.</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1032985"></A>ISUP event code                         SIP response
----------------                        ------------
1 Alerting                              180 Ringing
2 Progress                              183 Call progress
3 In-band information                   183 Call progress
4 Call forward; line busy               181 Call is being forwarded
5 Call forward; no reply                181 Call is being forwarded
6 Call forward; unconditional           181 Call is being forwarded
- (no event code present)               183 Call progress</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1033011"></A>Note that, if the CPG does not indicate &quot;Alerting,&quot; the current state will not change.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029202"></A>6.2.10.	ACK received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029203"></A>At this stage, the two-way voice channel may be modified based on the SDP present in the ACK. The call is connected and the conversation can take place.</P>
</DIV>
</DIV>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1029204"></A>7.	ISUP to SIP mapping</H1>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1030736"></A>7.1.	Call Flows</H2>
<P CLASS="Body">
<A NAME="pgfId-1033302"></A>The following call flows illustrate the order of messages in typical success and error cases when setting up a call initiated from the PSTN network. &quot;100 Trying&quot; acknowledgements to INVITE requests are not explained, since their presence is optional.</P>
<P CLASS="Body">
<A NAME="pgfId-1034381"></A>In these diagrams, all call singnalling (SIP, ISUP) is going to and from the MGC; media handling (e.g. audio cut-through, trunk freeing) is being performed by the MG, under the control of the MGC. For the purpose of simplicity, these are shown as a single node, labeled &quot;MGC/MG.&quot;</P>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030740"></A>7.1.1.	En-bloc call setup (non auto-answer)</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1034061"></A>SIP                       MGC/MG                       PSTN
  |                          |&lt;-----------IAM-----------|1
  |                          |==========Audio==========&gt;|
 2|&lt;--------INVITE-----------|                          |
  |-----------100-----------&gt;|                          |
 3|-----------18x-----------&gt;|                          |
  |==========Audio==========&gt;|                          |
  |                          |------------ACM----------&gt;|4
 5|&lt;---------PRACK-----------|                          |
 6|-----------200-----------&gt;|                          |
 7|-----------18x-----------&gt;|                          |
  |                          |------------CPG----------&gt;|8
 9|&lt;---------PRACK-----------|                          |
10|-----------200-----------&gt;|                          |
11|-----------200-----------&gt;|                          |
  |&lt;=========Audio==========&gt;|                          |
  |                          |------------ANM----------&gt;|12
  |                          |&lt;=========Audio==========&gt;|
13|&lt;----------ACK------------|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1031899"></A>(1)	When a PSTN user wishes to begin a session with a SIP user, the PSTN network generates an IAM message towards the gateway.</P>
<P CLASS="Step">
<A NAME="pgfId-1031900"></A>(2)	Upon receipt of the IAM message, the gateway generates an INVITE message, and sends it to an appropriate SIP node based on called number analysis.</P>
<P CLASS="Step">
<A NAME="pgfId-1031947"></A>(3)	When an event signifying that the call has sufficient addressing information occurs, the SIP node will generate a provisional response of 180 or greater. If this 180 contains a session description, </P>
<P CLASS="Step">
<A NAME="pgfId-1031949"></A>(4)	Upon receipt of a provisional response of 180 or greater, the gateway will generate an ACM message. If the response is not 180, the ACM will carry a &quot;called party status&quot; value of &quot;no indication.&quot;</P>
<P CLASS="Step">
<A NAME="pgfId-1031960"></A>(5)	The gateway sends a PRACK message  to confirm receipt of the provisional response.</P>
<P CLASS="Step">
<A NAME="pgfId-1031961"></A>(6)	The PRACK is confirmed</P>
<P CLASS="Step">
<A NAME="pgfId-1031917"></A>(7)	The SIP node may use further provisional messages to indicate call progress.</P>
<P CLASS="Step">
<A NAME="pgfId-1031918"></A>(8)	After an ACM has been sent, all provisional responses will translate into ISUP CPG messages as indicated in <A HREF="draft-camarillo-sip-isup-bcp-00.html#87051" CLASS="XRef">7.2.3.</A></P>
<P CLASS="Step">
<A NAME="pgfId-1031975"></A>(9)	The gateway sends a PRACK message  to confirm receipt of the provisional response.</P>
<P CLASS="Step">
<A NAME="pgfId-1031976"></A>(10)	The PRACK is confirmed</P>
<P CLASS="Step">
<A NAME="pgfId-1031923"></A>(11)	When the SIP node answers the call, it will send a 200 OK message.</P>
<P CLASS="Step">
<A NAME="pgfId-1031924"></A>(12)	Upon receipt of the 200 OK message, the gateway will send an ANM message towards the ISUP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1031925"></A>(13)	The gateway will send an ACK to the SIP node to acknowledge receipt of the INVITE final response.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030741"></A>7.1.2.	<A NAME="50372"></A>Overlap call setup</H3>
<P CLASS="Body">
<A NAME="pgfId-1033034"></A>Note that supporting overlap dialing in the SIP network is an option that may be deemed undesirable due to the large number of messages involved. In this case, the gateway may elect to collect digits until a timer expires or a stop digit (such as #) is entered by the user.</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1034087"></A>SIP                       MGC/MG                       PSTN
  |                          |&lt;-----------IAM-----------|1
  |                          |==========Audio==========&gt;|
 2|&lt;--------INVITE-----------|                          |
 3|-----------484-----------&gt;|                          |
 4|&lt;----------ACK------------|                          |
  |                          |&lt;-----------SAM-----------|5
 6|&lt;--------INVITE-----------|                          |
  |-----------100-----------&gt;|                          |
  |                          |&lt;-----------SAM-----------|7
 8|&lt;--------INVITE-----------|                          |
  |-----------100-----------&gt;|                          |
  |                          |&lt;-----------SAM-----------|9
10|&lt;--------INVITE-----------|                          |
  |-----------100-----------&gt;|                          |
  |                          |&lt;-----------SAM-----------|11
12|&lt;--------INVITE-----------|                          |
  |-----------100-----------&gt;|                          |
13|-----------18x-----------&gt;|                          |
  |==========Audio==========&gt;|                          |
14|&lt;---------PRACK-----------|                          |
  |                          |------------ACM----------&gt;|15
16|-----------484-----------&gt;|                          |
17|&lt;----------ACK------------|                          |
18|-----------484-----------&gt;|                          |
19|&lt;----------ACK------------|                          |
20|-----------484-----------&gt;|                          |
21|&lt;----------ACK------------|                          |
22|-----------200-----------&gt;|                          |
23|-----------18x-----------&gt;|                          |
  |                          |------------CPG----------&gt;|24
25|&lt;---------PRACK-----------|                          |
26|-----------200-----------&gt;|                          |
27|-----------200-----------&gt;|                          |
  |&lt;=========Audio==========&gt;|                          |
  |                          |------------ANM----------&gt;|28
  |                          |&lt;=========Audio==========&gt;|
29|&lt;----------ACK------------|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1032622"></A>(1)	When a PSTN user wishes to begin a session with a SIP user, the PSTN network generates an IAM message towards the gateway.</P>
<P CLASS="Step">
<A NAME="pgfId-1032623"></A>(2)	Upon receipt of the IAM message, the gateway generates an INVITE message, and sends it to an appropriate SIP node based on called number analysis. It is possible that the gateway won't have enough information to send the INVITE yet; this situation is not shown. Under these circumstances, the gateway holds on to the IAM until it has received enough digits that it knows where to send the INVITE.</P>
<P CLASS="Step">
<A NAME="pgfId-1032628"></A>(3)	The far end may immediately determine that it is unable to terminate the call due to an insufficient number of digits. It will return a &quot;484 Address Incomplete&quot; message under these circumstances.</P>
<P CLASS="Step">
<A NAME="pgfId-1032629"></A>(4)	The 484 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1032630"></A>(5)	A SAM arrives from the PSTN with additional digits present.</P>
<P CLASS="Step">
<A NAME="pgfId-1032631"></A>(6)	The gateway appends the new digits to the number it is sending in the &quot;To&quot; field and re-sends the INVITE.  This INVITE contains the same &quot;From&quot; and &quot;Call-ID&quot; headers. Since the &quot;To&quot; field of this message is different from the previous INVITE(s), this transaction represents a different call leg than the INVITE in step 1; consequently, there is no relationship between the CSeq values in the two INVITE messages.</P>
<P CLASS="Step">
<A NAME="pgfId-1032642"></A>(7)	See step 5</P>
<P CLASS="Step">
<A NAME="pgfId-1032643"></A>(8)	See step 6</P>
<P CLASS="Step">
<A NAME="pgfId-1032644"></A>(9)	See step 5</P>
<P CLASS="Step">
<A NAME="pgfId-1032645"></A>(10)	See step 6</P>
<P CLASS="Step">
<A NAME="pgfId-1032646"></A>(11)	See step 5</P>
<P CLASS="Step">
<A NAME="pgfId-1032647"></A>(12)	See step 6</P>
<P CLASS="Step">
<A NAME="pgfId-1032648"></A>(13)	Once the far end SIP node has determined that it has enough information to successfully route the call, it sends a 18x message.</P>
<P CLASS="Step">
<A NAME="pgfId-1032655"></A>(14)	The gateway sends a PRACK message  to confirm receipt of the provisional response.</P>
<P CLASS="Step">
<A NAME="pgfId-1033322"></A>(15)	Upon receipt of a provisional response of 180 or greater, the gateway will generate an ACM message to indicate that enough digits have been collected. If the response is not 180, the ACM will carry a &quot;called party status&quot; value of &quot;no indication.&quot;</P>
<P CLASS="Step">
<A NAME="pgfId-1032674"></A>(16)	&quot;484 Address Incomplete&quot; arrives to complete the INVITE transaction started in step 6.</P>
<P CLASS="Step">
<A NAME="pgfId-1032675"></A>(17)	The 484 in step 16 is acknowledged</P>
<P CLASS="Step">
<A NAME="pgfId-1032679"></A>(18)	&quot;484 Address Incomplete&quot; arrives to complete the INVITE transaction started in step 8.</P>
<P CLASS="Step">
<A NAME="pgfId-1032680"></A>(19)	The 484 in step 18 is acknowledged</P>
<P CLASS="Step">
<A NAME="pgfId-1032684"></A>(20)	&quot;484 Address Incomplete&quot; arrives to complete the INVITE transaction started in step 10.</P>
<P CLASS="Step">
<A NAME="pgfId-1032685"></A>(21)	The 484 in step 20 is acknowledged</P>
<P CLASS="Step">
<A NAME="pgfId-1032672"></A>(22)	The PRACK from step 14 is acknowledged</P>
<P CLASS="Step">
<A NAME="pgfId-1032690"></A>(23)	The SIP node may use further provisional messages to indicate call progress.</P>
<P CLASS="Step">
<A NAME="pgfId-1033313"></A>(24)	After an ACM has been sent, all provisional responses will translate into ISUP CPG messages as indicated in <A HREF="draft-camarillo-sip-isup-bcp-00.html#87051" CLASS="XRef">7.2.3.</A></P>
<P CLASS="Step">
<A NAME="pgfId-1032692"></A>(25)	The gateway sends a PRACK message  to confirm receipt of the provisional response.</P>
<P CLASS="Step">
<A NAME="pgfId-1032693"></A>(26)	The PRACK is confirmed</P>
<P CLASS="Step">
<A NAME="pgfId-1032694"></A>(27)	When the SIP node answers the call, it will send a 200 OK message.</P>
<P CLASS="Step">
<A NAME="pgfId-1032695"></A>(28)	Upon receipt of the 200 OK message, the gateway will send an ANM message towards the ISUP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1032696"></A>(29)	The gateway will send an ACK to the SIP node to acknowledge receipt of the INVITE final response.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1032504"></A>7.1.3.	<A NAME="93428"></A>Overlap call setup with a routing (redirect) server</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1032843"></A>Redirect Server           MGC/MG                       PSTN
  |                          |&lt;-----------IAM-----------|1
  |                          |==========Audio==========&gt;|
 2|&lt;--------INVITE-----------|                          |
 3|-----------484-----------&gt;|                          |
 4|&lt;----------ACK------------|                          |
  |                          |&lt;-----------SAM-----------|5
 6|&lt;--------INVITE-----------|                          |
 7|-----------484-----------&gt;|                          |
 8|&lt;----------ACK------------|                          |
  |                          |&lt;-----------SAM-----------|9
10|&lt;--------INVITE-----------|                          |
11|-----------302-----------&gt;|                          |
12|&lt;----------ACK------------|                          |
                             |                          |
                             |                          |
Egress MGC/MG                |                          |
13|&lt;--------INVITE-----------|                          |
  |-----------100-----------&gt;|                          |
  |                          |&lt;-----------SAM-----------|
              ...</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1032875"></A>(1)	When a PSTN user wishes to begin a session with a SIP user, the PSTN network generates an IAM message towards the gateway.</P>
<P CLASS="Step">
<A NAME="pgfId-1032880"></A>(2)	Upon receipt of the IAM message, the gateway generates an INVITE message, and sends it to an appropriate SIP node based on called number analysis. In this example, this node is a routing (redirection) server.</P>
<P CLASS="Step">
<A NAME="pgfId-1032853"></A>(3)	Since the routing server doesn't have enough information to select an egress gateway, it responds with a &quot;484 Address Incomplete&quot;.</P>
<P CLASS="Step">
<A NAME="pgfId-1032854"></A>(4)	The 484 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1032887"></A>(5)	After collecting more digits, the PSTN node sends a SAM with the additional digits.</P>
<P CLASS="Step">
<A NAME="pgfId-1032890"></A>(6)	The gateway appends the new digits to the number it is sending in the &quot;To&quot; field and re-sends the INVITE.  This INVITE contains the same &quot;From&quot; and &quot;Call-ID&quot; headers. Since the &quot;To&quot; field of this message is different from the previous INVITE(s), this transaction represents a different call leg than the INVITE in step 1; consequently, there is no relationship between the CSeq values in the two INVITE messages.</P>
<P CLASS="Step">
<A NAME="pgfId-1032856"></A>(7)	In this example, there is still not enough information to route the call.</P>
<P CLASS="Step">
<A NAME="pgfId-1032857"></A>(8)	The 484 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1032858"></A>(9)	See step 5. </P>
<P CLASS="Step">
<A NAME="pgfId-1032897"></A>(10)	See step 6.</P>
<P CLASS="Step">
<A NAME="pgfId-1032859"></A>(11)	The INVITE finally contains enough digits that the redirect server can select a next-hop SIP node. A &quot;302 Temporarily Moved&quot; response is returned to redirect the SIP node to the appropriate gateway. (In practice, this may not necessarily be a gateway; it might be another redirect server, a proxy server, or a native client). Note that it is quite probable that the called number is not completely collected at this time; sending an ACM towards the PSTN would be extremely destructive at this point in the call, since it would prevent any further collection of digits.</P>
<P CLASS="Step">
<A NAME="pgfId-1032860"></A>(12)	The 302 is acknowledged.</P>
<P CLASS="Step">
<A NAME="pgfId-1032864"></A>(13)	The call now continues as in step 2 of section <A HREF="draft-camarillo-sip-isup-bcp-00.html#50372" CLASS="XRef">7.1.2.</A></P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1032501"></A>7.1.4.	Auto-answer call setup</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1034112"></A>SIP                       MGC/MG                       PSTN
  |                          |&lt;-----------IAM-----------|1
  |                          |==========Audio==========&gt;|
 2|&lt;--------INVITE-----------|                          |
 3|-----------200-----------&gt;|                          |
  |&lt;=========Audio==========&gt;|                          |
  |                          |------------CON----------&gt;|4
  |                          |&lt;=========Audio==========&gt;|
 5|&lt;----------ACK------------|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1031981"></A>(1)	When a PSTN user wishes to begin a session with a SIP user, the PSTN network generates an IAM message towards the gateway.</P>
<P CLASS="Step">
<A NAME="pgfId-1031982"></A>(2)	Upon receipt of the IAM message, the gateway generates an INVITE message, and sends it to an appropriate SIP node based on called number analysis.</P>
<P CLASS="Step">
<A NAME="pgfId-1031983"></A>(3)	Since the SIP node is set up to automatically answer the call, it will send a 200 OK message.</P>
<P CLASS="Step">
<A NAME="pgfId-1031984"></A>(4)	Upon receipt of the 200 OK message, the gateway will send a CON  message towards the ISUP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1031985"></A>(5)	The gateway will send an ACK to the SIP node to acknowledge receipt of the INVITE final response.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030742"></A>7.1.5.	SIP Timeout</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1031113"></A>SIP                       MGC/MG                       PSTN
  |                          |&lt;-----------IAM-----------|1
  |                          |==========Audio==========&gt;|
 2|&lt;--------INVITE-----------|                          |
  |    *** T1 Expires ***    |                          |
 3|&lt;--------INVITE-----------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;--------INVITE-----------|                          |
  |                          |    *** T11 Expires ***   |
  |                          |------------ACM----------&gt;|4
  |    *** T1 Expires ***    |                          |
  |&lt;--------INVITE-----------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;--------INVITE-----------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;--------INVITE-----------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;--------INVITE-----------|                          |
  |    *** T1 Expires ***    |                          |
  |             ** MG Releases PSTN Trunk **            |
  |                          |------------REL----------&gt;|5
 6|&lt;--------CANCEL-----------|                          |
  |                          |&lt;-----------RLC-----------|7</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1031992"></A>(1)	When a PSTN user wishes to begin a session with a SIP user, the PSTN network generates an IAM message towards the gateway.</P>
<P CLASS="Step">
<A NAME="pgfId-1031993"></A>(2)	Upon receipt of the IAM message, the gateway generates an INVITE message, and sends it to an appropriate SIP node based on called number analysis. The ISUP timer T11 and SIP timer T1 are set at this time.</P>
<P CLASS="Step">
<A NAME="pgfId-1031994"></A>(3)	The INVITE message will continue to be sent to the SIP node each time the timer T1 expires. The SIP standard specifies that INVITE transmission will be performed 7 times if no response is received.</P>
<P CLASS="Step">
<A NAME="pgfId-1031995"></A>(4)	When T11 expires, an ACM message will be sent to the ISUP node to prevent the from being torn down by the remote node's ISUP T7. This ACM contains a `Called Party Status' value of `no indication.'</P>
<P CLASS="Step">
<A NAME="pgfId-1031996"></A>(5)	Once the maximum number of INVITE requests has been sent, the gateway will send a REL to the ISUP node to terminate the call. Since this would appear to be a serious problem with the network, the REL contains a cause code of 38: network out of order.</P>
<P CLASS="Step">
<A NAME="pgfId-1031997"></A>(6)	The gateway also sends a CANCEL message to the SIP node to terminate any initiation attempts.</P>
<P CLASS="Step">
<A NAME="pgfId-1031998"></A>(7)	Upon receipt of the REL, the remote ISUP node will send an RLC to acknowledge.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030743"></A>7.1.6.	<A NAME="49087"></A>ISUP T9 Expires</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1031235"></A>SIP                       MGC/MG                       PSTN
  |                          |&lt;-----------IAM-----------|1
  |                          |==========Audio==========&gt;|
 2|&lt;--------INVITE-----------|                          |
  |    *** T1 Expires ***    |                          |
 3|&lt;--------INVITE-----------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;--------INVITE-----------|                          |
  |                          |    *** T11 Expires ***   |
  |                          |------------ACM----------&gt;|4
  |    *** T1 Expires ***    |                          |
  |&lt;--------INVITE-----------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;--------INVITE-----------|                          |
  |    *** T1 Expires ***    |                          |
  |&lt;--------INVITE-----------|                          |
  |                          |    *** T9 Expires ***    |
  |             ** MG Releases PSTN Trunk **            |
  |                          |&lt;-----------REL-----------|5
  |                          |------------RLC----------&gt;|6
 7|&lt;--------CANCEL-----------|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1032013"></A>(1)	When a PSTN user wishes to begin a session with a SIP user, the PSTN network generates an IAM message towards the gateway.</P>
<P CLASS="Step">
<A NAME="pgfId-1032014"></A>(2)	Upon receipt of the IAM message, the gateway generates an INVITE message, and sends it to an appropriate SIP node based on called number analysis. The ISUP timer T11 and SIP timer T1 are set at this time.</P>
<P CLASS="Step">
<A NAME="pgfId-1032015"></A>(3)	The INVITE message will continue to be sent to the SIP node each time the timer T1 expires. The SIP standard specifies that INVITE transmission will be performed 7 times if no response is received. Since SIP T1 starts at 1/2 second or more and doubles each time it is retransmitted, it will be at least a minute before SIP times out the INVITE request; since SIP T1 is allowed to be larger than 500 ms initially, it is possible that 7 x SIP T1 will be longer than ISUP T11 + ISUP T9.</P>
<P CLASS="Step">
<A NAME="pgfId-1033328"></A>(4)	When T11 expires, an ACM message will be sent to the ISUP node to prevent the from being torn down by the remote node's ISUP T7. This ACM contains a `Called Party Status' value of `no indication.'</P>
<P CLASS="Step">
<A NAME="pgfId-1032017"></A>(5)	When ISUP T9 in the remote PSTN node expires, it will send a REL.</P>
<P CLASS="Step">
<A NAME="pgfId-1032033"></A>(6)	Upon receipt of the REL, the gateway will send an RLC to acknowledge.</P>
<P CLASS="Step">
<A NAME="pgfId-1032018"></A>(7)	The REL will trigger a CANCEL request, which gets sent to the SIP node.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030744"></A>7.1.7.	SIP Error Response</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1031273"></A>SIP                       MGC/MG                       PSTN
  |                          |&lt;-----------IAM-----------|1
  |                          |==========Audio==========&gt;|
 2|&lt;--------INVITE-----------|                          |
 3|-----------4xx+----------&gt;|                          |
 4|&lt;----------ACK------------|                          |
  |             ** MG Releases PSTN Trunk **            |
  |                          |------------REL----------&gt;|5
  |                          |&lt;-----------RLC-----------|6</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1032040"></A>(1)	When a PSTN user wishes to begin a session with a SIP user, the PSTN network generates an IAM message towards the gateway.</P>
<P CLASS="Step">
<A NAME="pgfId-1032041"></A>(2)	Upon receipt of the IAM message, the gateway generates an INVITE message, and sends it to an appropriate SIP node based on called number analysis.</P>
<P CLASS="Step">
<A NAME="pgfId-1032042"></A>(3)	The SIP node indicates an error condition by replying with a response with a code of 400 or greater.</P>
<P CLASS="Step">
<A NAME="pgfId-1032054"></A>(4)	The gateway sends an ACK message to acknowledge receipt of the INVITE final response.</P>
<P CLASS="Step">
<A NAME="pgfId-1032059"></A>(5)	An ISUP REL message is generated from the SIP code, as specified in section <A HREF="draft-camarillo-sip-isup-bcp-00.html#48929" CLASS="XRef">7.2.6.</A></P>
<P CLASS="Step">
<A NAME="pgfId-1032047"></A>(6)	The remote ISUP node confirms receipt of the REL message with an RLC message.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030745"></A>7.1.8.	SIP Redirection</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1034170"></A>SIP node 1                MGC/MG                       PSTN
  |                          |&lt;-----------IAM-----------|1
  |                          |==========Audio==========&gt;|
 2|&lt;--------INVITE-----------|                          |
 3|-----------3xx+----------&gt;|                          |
  |                          |------------CPG----------&gt;|4
 5|&lt;----------ACK------------|                          |
                             |                          |
                             |                          |
SIP node 2                   |                          |
 6|&lt;--------INVITE-----------|                          |
 7|-----------18x-----------&gt;|                          |
  |&lt;=========Audio===========|                          |
  |                          |------------ACM----------&gt;|8
 9|&lt;---------PRACK-----------|                          |
10|-----------200-----------&gt;|                          |
11|-----------200-----------&gt;|                          |
  |&lt;=========Audio==========&gt;|                          |
  |                          |------------ANM----------&gt;|12
  |                          |&lt;=========Audio==========&gt;|
13|&lt;----------ACK------------|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1032068"></A>(1)	When a PSTN user wishes to begin a session with a SIP user, the PSTN network generates an IAM message towards the gateway.</P>
<P CLASS="Step">
<A NAME="pgfId-1032069"></A>(2)	Upon receipt of the IAM message, the gateway generates an INVITE message, and sends it to an appropriate SIP node based on called number analysis.</P>
<P CLASS="Step">
<A NAME="pgfId-1032070"></A>(3)	The SIP node indicates that the resource which the user is attempting to contact is at a different location by sending a 3xx message.</P>
<P CLASS="Step">
<A NAME="pgfId-1032071"></A>(4)	The gateway sends a CPG with event indication that the call is being forwarded upon receipt of the 3xx message. Note that this translation should be able to be disabled by configuration, as some ISUP nodes do not support receipt of CPG messages before ACM messages.</P>
<P CLASS="Step">
<A NAME="pgfId-1032072"></A>(5)	The gateway acknowledges receipt of the INVITE final response by sending an ACK message to the SIP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1032073"></A>(6)	The gateway re-sends the INVITE message to the address indicated in the Contact: field of the 3xx message.</P>
<P CLASS="Step">
<A NAME="pgfId-1032074"></A>(7)	When an event signifying that the call has sufficient addressing information occurs, the SIP node will generate a provisional response of 180 or greater.</P>
<P CLASS="Step">
<A NAME="pgfId-1032075"></A>(8)	Upon receipt of a provisional response of 180 or greater, the gateway will generate an ACM message with an event code as indicated in section <A HREF="draft-camarillo-sip-isup-bcp-00.html#87051" CLASS="XRef">7.2.3.</A></P>
<P CLASS="Step">
<A NAME="pgfId-1032092"></A>(9)	The gateway sends a PRACK message  to confirm receipt of the provisional response.</P>
<P CLASS="Step">
<A NAME="pgfId-1032093"></A>(10)	The PRACK is confirmed</P>
<P CLASS="Step">
<A NAME="pgfId-1032080"></A>(11)	When the SIP node answers the call, it will send a 200 OK message.</P>
<P CLASS="Step">
<A NAME="pgfId-1032081"></A>(12)	Upon receipt of the 200 OK message, the gateway will send an ANM message towards the ISUP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1032082"></A>(13)	The gateway will send an ACK to the SIP node to acknowledge receipt of the INVITE final response.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030749"></A>7.1.9.	Call Cancelled by ISUP</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1034180"></A>SIP                       MGC/MG                       PSTN
  |                          |&lt;-----------IAM-----------|1
  |                          |==========Audio==========&gt;|
 2|&lt;--------INVITE-----------|                          |
 3|-----------18x-----------&gt;|                          |
  |==========Audio==========&gt;|                          |
  |                          |------------ACM----------&gt;|4
 5|&lt;---------PRACK-----------|                          |
 6|-----------200-----------&gt;|                          |
  |             ** MG Releases PSTN Trunk **            |
  |                          |&lt;-----------REL-----------|7
  |                          |------------RLC----------&gt;|8
 9|&lt;---------CANCEL----------|                          |
  |            ** MG Releases IP Resources **           |
10|-----------200-----------&gt;|                          |
11|-----------487-----------&gt;|                          |
12|&lt;----------ACK------------|                          |</PRE>
</P>
<P CLASS="Step">
<A NAME="pgfId-1032108"></A>(1)	When a PSTN user wishes to begin a session with a SIP user, the PSTN network generates an IAM message towards the gateway.</P>
<P CLASS="Step">
<A NAME="pgfId-1032109"></A>(2)	Upon receipt of the IAM message, the gateway generates an INVITE message, and sends it to an appropriate SIP node based on called number analysis.</P>
<P CLASS="Step">
<A NAME="pgfId-1032110"></A>(3)	When an event signifying that the call has sufficient addressing information occurs, the SIP node will generate a provisional response of 180 or greater.</P>
<P CLASS="Step">
<A NAME="pgfId-1032111"></A>(4)	Upon receipt of a provisional response of 180 or greater, the gateway will generate an ACM message with an event code as indicated in section <A HREF="draft-camarillo-sip-isup-bcp-00.html#87051" CLASS="XRef">7.2.3.</A></P>
<P CLASS="Step">
<A NAME="pgfId-1032133"></A>(5)	The gateway sends a PRACK message  to confirm receipt of the provisional response.</P>
<P CLASS="Step">
<A NAME="pgfId-1032134"></A>(6)	The PRACK is confirmed</P>
<P CLASS="Step">
<A NAME="pgfId-1032116"></A>(7)	If the calling party hangs up before the SIP node answers the call, a REL message will be generated.</P>
<P CLASS="Step">
<A NAME="pgfId-1032137"></A>(8)	The gateway frees the PSTN circuit and indicates that it is available for reuse by sending an RLC.</P>
<P CLASS="Step">
<A NAME="pgfId-1032117"></A>(9)	Upon receipt of a REL message before an INVITE final response, the gateway will send a CANCEL towards the SIP node.</P>
<P CLASS="Step">
<A NAME="pgfId-1032118"></A>(10)	Upon receipt of the CANCEL, the SIP node will send a 200 response.</P>
<P CLASS="Step">
<A NAME="pgfId-1032140"></A>(11)	The remote SIP node will send a &quot;487 Call Cancelled&quot; to complete the INVITE transaction.</P>
<P CLASS="Step">
<A NAME="pgfId-1032143"></A>(12)	The gateway will send an ACK to the SIP node to acknowledge receipt of the INVITE final response.</P>
</DIV>
</DIV>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1030737"></A>7.2.	State Machine</H2>
<P CLASS="Body">
<A NAME="pgfId-1033016"></A>Note that REL may arrive in any state. Whenever this occurs, the actions in section <A HREF="draft-camarillo-sip-isup-bcp-00.html#42093" CLASS="XRef">7.2.7.</A> are taken. Not all of these transitions are shown in this diagram.</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1033719"></A>                              +---------+
     +-----------------------&gt;|  Idle   |&lt;---------------------+
     |                        +----+----+                      |
     |                             |                           |
     |                             | IAM/7.2.1                 |
     |                             V                           |
     |    REL/7.2.7    +-------------------------+ 400+/7.2.6  |
     +&lt;----------------+         Trying          |------------&gt;|
     |                 +-+--------+------+-------+             |
     |                   |        |      |                     |
     |                   | T11/   | 18x/ | 200/                |
     |                   | 7.2.8  |7.2.3 | 7.2.4               |
     |                   V        |      |                     |
     | REL/7.2.7 +--------------+ |      |      400+/7.2.6     |
     |&lt;----------| Progressing  |-|------|--------------------&gt;|
     |           +--+----+------+ |      |                     |
     |              |    |        |      |                     |
     |        200/  |    | 18x/   |      |                     |
     |        7.2.4 |    | 7.2.3  |      |                     |
     |              |    V        V      |                     |
     |  REL/7.2.7   |  +---------------+ |      400+/7.2.6     |
     |&lt;-------------|--|    Alerting   |-|--------------------&gt;|
     |              |  +--------+------+ |                     |
     |              |           |        |                     |
     |              |           | 200/   |                     |
     |              |           | 7.2.4  |                     |
     |              V           V        V                     |
     |     BYE/9.1 +-----------------------------+    REL/9.1  |
     +&lt;------------+          Connected          +------------&gt;+
                   +-----------------------------+</PRE>
</P>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029209"></A>7.2.1.	 Address received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029210"></A>Upon the reception of an IAM, resources are reserved in the media gateway  and it connects audio in the backwards direction (towards the caller).</P>
<P CLASS="Body">
<A NAME="pgfId-1029211"></A>The called number can be received in just one IAM (`en bloc' signalling) or in one IAM followed by one or several SAMs (overlap signalling). In some countries there is no way for the MGC to know whether the callees' number is already complete or some SAMs will still arrive.</P>
<P CLASS="Body">
<A NAME="pgfId-1029212"></A>If the MGC relies on the inter-digit timeout to assume that the number is complete, the establishment of the connection is delayed. Alternatively, if the MGC sends the INVITE request immediately after receiving the IAM, heavy signalling traffic may be generated.</P>
<P CLASS="Body">
<A NAME="pgfId-1029213"></A>Therefore, an individual MGC might implement a timer and/or a stop digit (such as #). All the digits that arrive before this timer expires will be included in the INVITE sent. The timer can be bypassed by the user sending the stop digit. This timer should not be larger than 5 seconds.</P>
<P CLASS="Body">
<A NAME="pgfId-1029214"></A>Thus, after receiving the IAM and possibly one or several SAMs, the MGC issues an INVITE request. The &quot;To&quot; field contains the digits received so far. If, after sending this INVITE request, one or more SAMs are received, the MGC sends a new INVITE. This new INVITE has the same &quot;From&quot; and &quot;Call-ID&quot; as  the previous INVITE sent. The &quot;To&quot; field is updated and contains all the available digits.</P>
<P CLASS="Body">
<A NAME="pgfId-1029215"></A>`484 Address Incomplete' responses will be received for all the INVITEs sent with the incomplete callees number. Thus, all the call legs (same `Call-ID', different to) created while the digits are arriving are deleted.</P>
<P CLASS="Body">
<A NAME="pgfId-1033045"></A>See sections <A HREF="draft-camarillo-sip-isup-bcp-00.html#80239" CLASS="XRef">6.1.2.</A> and <A HREF="draft-camarillo-sip-isup-bcp-00.html#50372" CLASS="XRef">7.1.2.</A> for a more detailed handling of overlapped dialing.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029216"></A>7.2.2.	100 received</H3>
<P CLASS="Body">
<A NAME="pgfId-1033051"></A>A 100 response does not trigger any PSTN interworking messages; it only serves the purpose of suppressing INVITE retransmissions.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1033050"></A>7.2.3.	<A NAME="87051"></A>18x received</H3>
<P CLASS="Body">
<A NAME="pgfId-1033059"></A>If no ACM has been sent yet and no ISUP is present in the 18x message body, and ISUP message is generated according to the following table Note that, if an early ACM is sent, the call enters state &quot;Progressing&quot; instead of state &quot;Alerting.&quot;</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029913"></A>Response received                        Message sent by the MGC
-----------------                        -----------------------
180 Ringing                              ACM
181 Call is being forwarded              Early ACM and CPG, event=6
182 Queued                               ACM
183 Session progress message             ACM</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1033073"></A>If an ACM has already been sent and no ISUP is present in the 18x message body, an ISUP message is generated according to the following table.</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1033068"></A>Response received                        Message sent by the MGC
-----------------                        -----------------------
180 Ringing                              CPG, event = 1 (Alerting)
181 Call is being forwarded              CPG, event = 6 (Forwarding)
182 Queued                               CPG, event = 2 (Progress)
183 Session progress message             CPG, event = 2 (Progress)</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1033062"></A>If the reception of a `180 Ringing' response without media description, the MG generates the ringback tone to be heard by the caller.</P>
<P CLASS="Body">
<A NAME="pgfId-1029224"></A>If the MGC receives any 1xx response (except 100)  with a session description present for media setup, it sets up the session being described. The call progress media (e.g. ringback tone or  announcement) is generated by an entity downstream (in the SIP network or by a PSTN exchange in SIP bridging situations).</P>
<P CLASS="Body">
<A NAME="pgfId-1029225"></A>If an ACM has not been sent yet, one is generated and sent. The mandatory parameters of the ACM are described below:</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029929"></A>Message type:                            ACM

Backward Indicators
Charge indicator:                      10 charge
Called party's status indicator:       01 subscriber free or
                                       00 no indication (E.ACM)
Called party's category indicator:     01 ordinary subscriber
End-to-end method indicator:           00 no end-to-end method
Interworking indicator:                0  no interworking
End-to-end information indicator:      0  no end-to-end info
ISDN user part indicator:              1  ISUP all the way
Holding indicator:                     0  no holding
ISDN access indicator:                 1  ISDN access
Echo control device indicator:         It depends on the call
SCCP method indicator:                 00 no indication</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1029228"></A>In SIP bridging situations the MGC sends the ISUP message contained in the response body.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029229"></A>7.2.4.	200 received</H3>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029950"></A>Response received                        Message sent by the MGC
-----------------                        -----------------------
200 OK                                   ANM, ACK</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1029947"></A>After receiving a 200 OK response the MGC establishes a two-way voice path in the MG and it sends an ANM to the PSTN and an ACK to the SIP network.</P>
<P CLASS="Body">
<A NAME="pgfId-1029233"></A>If the `200 OK' response arrives before the MGC has sent the ACM, a CON is sent instead of the ANM.</P>
<P CLASS="Body">
<A NAME="pgfId-1029234"></A>In SIP bridging situations the MGC sends the ANM or the CON in the response body. If the response body contains an ACM and an ANM both are sent to the PSTN (first the ACM and then the ANM).</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029235"></A>7.2.5.	3xx received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029241"></A>When any 3xx  response is received ,the MGC should try to contact the user using the `Contact' header or headers present in the response. These 3xx responses are typically sent by a re-direct server. This is a similar device to the HLR in mobile networks. It provides another address where the callee may be reached.</P>
<P CLASS="Body">
<A NAME="pgfId-1033105"></A>A CPG message with an event code of 2 (Progress) may be sent to indicate that the call is proceeding. Note that some ISUP nodes may not support CPG before ACM, so this feature should be configurable.</P>
<P CLASS="Body">
<A NAME="pgfId-1033108"></A>The 3xx MUST NOT  result in the generation of an ACM message, since there may be more digits pending in overlap dialing situations. See sections <A HREF="draft-camarillo-sip-isup-bcp-00.html#78879" CLASS="XRef">6.1.3.</A> and <A HREF="draft-camarillo-sip-isup-bcp-00.html#93428" CLASS="XRef">7.1.3.</A> for callflows that demonstrate the situations in which this behavior would prove harmful.</P>
<P CLASS="Body">
<A NAME="pgfId-1029243"></A>In SIP bridging situations, the MGC sends the ISUP message contained in the response body (if any). It is worthwhile mentioning that a REL with cause value 22 (number changed) might be contained in the response body of the 3xx response. This REL might contain a new number where the callee might be reachable.</P>
<P CLASS="Body">
<A NAME="pgfId-1029244"></A>This REL can be sent to the PSTN, but most of the PSTN switches are not able to process this information. Thus, if the MGC is able to parse the new number, it might try the new location.</P>
<P CLASS="Body">
<A NAME="pgfId-1029245"></A>If the new location is reachable via PSTN, the MGC sends a new IAM and from that moment on acts as a normal PSTN switch (no SIP involved). If the new location is reachable using SIP, the MGC sends an INVITE with possibly a new IAM generated by the MGC in the message body.</P>
<P CLASS="Body">
<A NAME="pgfId-1029247"></A>All redirection situations have to be treated very carefully because they involved special charging situations. In PSTN the caller typically pays the first call leg and the callee pays the second.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029248"></A>7.2.6.	<A NAME="48929"></A>4xx - 6xx received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029999"></A>The MGC releases the resources in the MG, send a REL to the PSTN with a cause value and send an ACK to the SIP network. An RLC arrives indicating that the release sequence is complete.</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1030001"></A>Response received                        Cause value in the REL
-----------------                        ----------------------
400 Bad request                         127 Interworking
401 Unauthorized                         21 Call rejected
402 Payment required                     21 Call rejected
403 Forbidden                             1 Unallocated number
404 Not found                             1 Unallocated number
405 Method not allowed                   38 Network out of order
406 Not acceptable                       58 Bearer capability not
                                            presently available
407 Proxy authentication required        21 Call rejected
408 Request timeout                     102 Recovery on timer expiry
409 Conflict                             41 Temporary failure
410 Gone                                  1 Unallocated number
411 Length required                     127 Interworking
413 Request Entity too long             127 Interworking
414 Request-URI too long                127 Interworking
415 Unsupported media type               79 Service/option not
                                            implemented
420 Bad extension                       127 Interworking
480 Temporarily unavailable              18 No user responding
481 Call leg/transaction doesn't exist  127 Interworking
482 Loop detected                       127 Interworking
483 Too many hoops                      127 Interworking
484 Address incomplete                  ---
485 Ambiguous                             1  Unallocated number
486 Busy here                            17 User busy
500 Server internal error                41 Temporary failure
501 Not implemented                      38 Network out of order
502 Bad gateway                          38 Network out of order
503 Service unavailable                  41 Temporary failure
504 Gateway time-out                    102 Recovery on timer expiry
505 Version not supported               127 Interworking
600 Busy everywhere                      17 User busy
603 Decline                              21 Call rejected
604 Does not exist anywhere               1 Unallocated number
606 Not acceptable                       38 Network out of order</PRE>
</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1030089"></A>7.2.7.	<A NAME="42093"></A>REL received</H3>
<P CLASS="Body">
<A NAME="pgfId-1029270"></A>The MGC should abort the establishment of the session. A CANCEL request has to be issued. A BYE is not used, since no final response has arrived from the SIP side. A 200 OK for the CANCEL arrives, and a 487 for the INVITE arrives.</P>
<P CLASS="Body">
<A NAME="pgfId-1033150"></A>The MGC has to store state information for a certain period of time, since a 200 final response for the INVITE originally sent might arrive (even after the reception of the 200 OK for the CANCEL). In this situation, the MGC sends an ACK and then a BYE.</P>
<P CLASS="Body">
<A NAME="pgfId-1029272"></A>In SIP bridging situations, the REL message may be included in the CANCEL message body. CANCEL requests are answered with a final response (such as 200 OK) by the first proxy. Therefore, the MGC does not know if the CANCEL has arrived to the end user (egress MGC in this scenario). Hence, if a 200 OK response for the previously sent INVITE arrives the MGC sends an ACK and then a BYE with the REL in the message body.</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029273"></A>7.2.8.	ISUP T11 Expires</H3>
<P CLASS="Body">
<A NAME="pgfId-1033157"></A>In order to prevent the remote ISUP node's timer T7 from expiring, the gateway may choose to keep its own supervisory timer; ISUP defines this timer as T11. T11's duration is carefully chosen so that it will always be shorter than the T7 of any node to which the gateway is communicating.</P>
<P CLASS="Body">
<A NAME="pgfId-1036119"></A>To clarify timer T11's relevance with respect to SIP interworking, Q.764 <A HREF="draft-camarillo-sip-isup-bcp-00.html#27307" CLASS="XRef">[14]</A> explains its use as: &quot;If in normal operation, a delay in the receipt of an address complete signal from the succeeding network is expected, the last common channel signalling exchange will originate and send an address complete message 15 to 20 seconds [timer (T11)] after receiving the latest address message.&quot; Since SIP nodes have no obligation to respond to an INVITE request within 20 seconds,  SIP interworking inarguably qualifies as such a situation.</P>
<P CLASS="Body">
<A NAME="pgfId-1033158"></A>If the gateway's T11 expires, it will send an early ACM (i.e. called party status set to &quot;no indication&quot;) to prevent the expiration of the remote node's T7. See section <A HREF="draft-camarillo-sip-isup-bcp-00.html#87051" CLASS="XRef">7.2.3.</A> for the value of the ACM parameters.</P>
<P CLASS="Body">
<A NAME="pgfId-1033166"></A>If a &quot;180 Ringing&quot; message arrives subsequently, it will be sent in a CPG, as shown in section <A HREF="draft-camarillo-sip-isup-bcp-00.html#87051" CLASS="XRef">7.2.3.</A></P>
<P CLASS="Body">
<A NAME="pgfId-1033174"></A>See <A HREF="draft-camarillo-sip-isup-bcp-00.html#49087" CLASS="XRef">7.1.6.</A> for an example callflow that includes the expiration of T11.</P>
</DIV>
</DIV>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1033025"></A>8.	Suspend/Resume</H1>
<P CLASS="Body">
<A NAME="pgfId-1031523"></A>In ISDN networks, the user can generate a SUS (timer T2, user initiated) in order to unplug the terminal from the socket and plug it in another one. A RES is sent once the terminal has been reconnected and the T2 timer has not expired.</P>
<P CLASS="Body">
<A NAME="pgfId-1031524"></A>When a SUS arrives from the PSTN, the MGC sends an INVITE to put the media stream on hold. The reception of a RES triggers another INVITE that resumes the media stream. For the SIP UAC/UAS the result is an interruption in the voice path until the other party picks up the phone again.</P>
<P CLASS="Body">
<A NAME="pgfId-1031525"></A>In SIP bridging situations, the SUS and RES messages can be transferred in the body of the INVITE.</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1031458"></A>SIP                       MGC/MG                       PSTN
  |                          |&lt;-----------SUS-----------|1
 2|&lt;--------INVITE-----------|                          |
 3|-----------200-----------&gt;|                          |
 4|&lt;----------ACK------------|                          |
  |                          |&lt;-----------RES-----------|5
 6|&lt;--------INVITE-----------|                          |
 7|-----------200-----------&gt;|                          |
 8|&lt;----------ACK------------|                          |</PRE>
</P>
<P CLASS="Body">
<A NAME="pgfId-1033693"></A>The handling of a network-initiated SUS prior to call teardown is handled in section <A HREF="draft-camarillo-sip-isup-bcp-00.html#94113" CLASS="XRef">9.2.2.</A></P>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1031554"></A>9.	Normal Release of the Connection</H1>
<P CLASS="Body">
<A NAME="pgfId-1031570"></A>Either the SIP side or the ISUP side may release a call, regardless of which side initiated the call.</P>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1031555"></A>9.1.	SIP initiated</H2>
<P CLASS="Body">
<A NAME="pgfId-1033185"></A>For a normal release of the call (reception of BYE), the MGC immediately sends a 200 response. It then releases the resources in the MG and sends an REL with a cause code of 16 (normal call clearing) to the PSTN. Release of resources is confirmed by the PSTN with a RLC.</P>
<P CLASS="Body">
<A NAME="pgfId-1033193"></A>In SIP bridging situations, the REL contained in the BYE is sent to the PSTN.</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1031556"></A>SIP                       MGC/MG                       PSTN
 1|-----------BYE-----------&gt;|                          |
  |            ** MG Releases IP Resources **           |
 2|&lt;----------200------------|                          |
  |             ** MG Releases PSTN Trunk **            |
  |                          |------------REL----------&gt;|3
  |                          |&lt;-----------RLC-----------|4</PRE>
</P>
</DIV>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1031380"></A>9.2.	ISUP Initiated</H2>
<P CLASS="Body">
<A NAME="pgfId-1033198"></A>If the release of the connection was caused by the reception of a REL, the REL is included in the BYE sent by the MGC.</P>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1031419"></A>9.2.1.	Caller hangs up</H3>
<P CLASS="Body">
<A NAME="pgfId-1033240"></A>For a normal release of the call (reception of REL from the PSTN), the MGC first releases the resources in the MG and then confirms that they are ready for re-use by sending an RLC. The SIP connection is released by sending a  BYE (which is confirmed with a 200).</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1034259"></A>SIP                       MGC/MG                       PSTN
  |                          |&lt;-----------REL-----------|1
  |             ** MG Releases PSTN Trunk **            |
  |                          |------------RLC----------&gt;|2
 3|&lt;----------BYE------------|                          |
  |            ** MG Releases IP Resources **           |
 4|-----------200-----------&gt;|                          |</PRE>
</P>
</DIV>
<DIV>
<H3 CLASS="Heading3">
<A NAME="pgfId-1029274"></A>9.2.2.	<A NAME="94113"></A>Callee hangs up</H3>
<P CLASS="Body">
<A NAME="pgfId-1031536"></A>In analog PSTN, if the callee hangs up in the middle of a call, the local exchange sends a SUS instead of a REL and starts a timer (T6, SUS is network initiated). When the timer expires, the REL is sent.</P>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1031423"></A>SIP                       MGC/MG                       PSTN
  |                          |&lt;-----------SUS-----------|1
 2|&lt;--------INVITE-----------|                          |
 3|-----------200-----------&gt;|                          |
 4|&lt;----------ACK------------|                          |
  |                          |    *** T6 Expires ***    |
  |                          |&lt;-----------REL-----------|5
  |             ** MG Releases PSTN Trunk **            |
  |                          |------------RLC----------&gt;|6
 7|&lt;----------BYE------------|                          |
  |            ** MG Releases IP Resources **           |
 8|-----------200-----------&gt;|                          |</PRE>
</P>
</DIV>
</DIV>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1029280"></A>10.	ISUP maintenance messages</H1>
<P CLASS="Body">
<A NAME="pgfId-1033703"></A>ISUP contains a set of messages used for maintenance purposes. They can be received during an ongoing call. There are basically two kinds of maintenance messages (apart from the continuity check): message for blocking circuits and messages for resetting circuits.</P>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1033704"></A>10.1.	Reset messages</H2>
<P CLASS="Body">
<A NAME="pgfId-1033705"></A>Upon reception of a reset message for the circuit being used, the call has to be released. RSC messages are answered with RLC after resetting the circuit in the MG. GRS messages are answered with GRA after resetting all the circuits affected by the message.</P>
<P CLASS="Body">
<A NAME="pgfId-1033706"></A>The MGC acts as if a REL had been received in order to release the connection on the SIP side. The session will be terminated. A BYE or a CANCEL are sent depending of the status of the call.</P>
</DIV>
<DIV>
<H2 CLASS="Heading2">
<A NAME="pgfId-1033707"></A>10.2.	Blocking messages</H2>
<P CLASS="Body">
<A NAME="pgfId-1033708"></A>There are two kinds of blocking messages: maintenance oriented or hardware failure oriented. Maintenance oriented blocking messages indicates that the circuit has to be blocked for subsequent calls. Therefore, these messages do not affect any ongoing call.</P>
<P CLASS="Body">
<A NAME="pgfId-1033709"></A>Hardware oriented blocking messages have to be treated as reset messages. The call is released.</P>
<P CLASS="Body">
<A NAME="pgfId-1033710"></A>BLO is always maintenance oriented and it is answered by the MGC with BLA when the circuit is blocked. CGB messages have a &quot;type indicator&quot; inside the &quot;circuit group supervision message type indicator&quot;. It indicates if the CGB is maintenance or hardware failure oriented. CGBs are answered with CGBAs.&quot; </P>
</DIV>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1033698"></A>11.	Other ISUP flavours</H1>
<P CLASS="Body">
<A NAME="pgfId-1029281"></A>Other flavours of ISUP different than Q.767 <A HREF="draft-camarillo-sip-isup-bcp-00.html#65973" CLASS="XRef">[2]</A> have more parameters and more features. Some of the parameters have more possible values and provide more information about the status of the call.</P>
<P CLASS="Body">
<A NAME="pgfId-1029282"></A>However, differences in the message flows are more important. In ANSI ISUP <A HREF="draft-camarillo-sip-isup-bcp-00.html#10269" CLASS="XRef">[3]</A>, there is no CON message. An ANM is sent instead (with no ACM). In call forwarding situations, CPGs can be sent before the ACM is sent. No SAMs are sent. `En bloc' signalling is always used.</P>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1029283"></A>12.	Acronyms</H1>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1033837"></A>ACK                Acknowledgment
ACM                Address Complete Message
ANM                Answer Message
ANSI               American National Standards Institute
BLA                Blocking ACK message
BLO                Blocking Message
CGB                Circuit Group Blocking Message
CGBA               Circuit Group Blocking ACK Message
CON                Connect Message
CPG                Call Progress Message
CUG                Closed User Group
GRA                Circuit Group Reset ACK Message
GRS                Circuit Group Reset Message
HLR                Home Location Register
IAM                Initial Address Message
IETF               Internet Engineering Task Force
IP                 Internet Protocol
ISDN               Integrated Services Digital Network
ISUP               ISDN User Part
ITU-T              International Telecommunication Union
                   Telecommunication Standardization Sector
MG                 Media Gateway
MGC                Media Gateway Controller
MTP                Message Transfer Part
REL                Release Message
RES                Resume Message
RLC                Release Complete Message
RTP                Real-time Transport Protocol
SCCP               Signalling Connection Control Part
SG                 Signalling Gateway
SIP                Session Initiation Protocol
SS7                System Signalling No. 7
SUS                Suspend Message
UAC                User Agent Client
UAS                User Agent Server
UDP                User Data Protocol
VoIP               Voice over IP</PRE>
</P>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1029285"></A>13.	Acknowledgments</H1>
<P CLASS="Body">
<A NAME="pgfId-1029286"></A>The authors would like to thank Olli Hynonen, Tomas Mecklin, Bill Kavadas, and Miguel A. Garcia for their help and feedback on this document.</P>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-998471"></A>14.	References</H1>
<P CLASS="Reference">
<A NAME="pgfId-1034713"></A>[1]	<A NAME="53863"></A>M. Handley/H. Schulzrinne/E. Schooler/J. Rosenberg, &quot;SIP: Session Initiation Protocol&quot;, RFC 2543, IETF; March 1999.</P>
<P CLASS="Reference">
<A NAME="pgfId-1034715"></A>[2]	<A NAME="65973"></A>&quot;Application of the ISDN user part of CCITT signalling system No. 7 for international ISDN interconnections&quot; ITU-T Q.767 recommendation, February 1991.</P>
<P CLASS="Reference">
<A NAME="pgfId-1029080"></A>[3]	<A NAME="10269"></A>&quot;Signalling System No. 7; ISDN User Part&quot; T1.113-1995 ANSI. January 1995.</P>
<P CLASS="Reference">
<A NAME="pgfId-1034691"></A>[4]	<A NAME="93858"></A>E Zimmerer/A. Vemuri/L. Ong/M. Zonoun/M. Watson, &quot;MIME media types for ISUP and QSIG Objects&quot;, Internet Draft &lt;draft-ietf-sip-isup-mime-00.txt&gt;, IETF; January 2000. Work in progress.</P>
<P CLASS="Reference">
<A NAME="pgfId-1034699"></A>[5]	<A NAME="83366"></A>N. Freed/ N. Borenstein, &quot;Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types&quot;, RFC 2046, IETF; November 1996.</P>
<P CLASS="Reference">
<A NAME="pgfId-1034695"></A>[6]	<A NAME="82742"></A>H. Schulzrinne/S. Petrack, &quot;RTP Payload for DTMF Digits, Telephony Tones and Telephony Signals&quot;, Internet Draft &lt;draft-ietf-avt-tones-07.txt&gt;, IETF; February 2000. Work in progress.</P>
<P CLASS="Reference">
<A NAME="pgfId-1034615"></A>[7]	<A NAME="77832"></A>Jiri Kuthan, &quot;Sample Uses of SIP INFO with Varying Reliability Needs&quot;, Internet Draft &lt;draft-kuthan-sip-infopayload-00.txt&gt;, IETF; October 1999. Work in progress.</P>
<P CLASS="Reference">
<A NAME="pgfId-1034519"></A>[8]	<A NAME="93140"></A>J. Rosenberg/H. Schulzrinne, &quot;Reliability of Provisional Responses in SIP&quot;, Internet Draft &lt;draft-ietf-sip-100rel-00.txt&gt;, IETF; January 2000. Work in progress.</P>
<P CLASS="Reference">
<A NAME="pgfId-1034737"></A>[9]	<A NAME="91880"></A>S. Donovan/M. Cannon/H. Schulzrinne/J. Rosenberg/A. Roach, &quot;SIP 183 Session Progress Message&quot;, Internet draft IETF October 1999. Work in progress.</P>
<P CLASS="Reference">
<A NAME="pgfId-1034533"></A>[10]	<A NAME="54270"></A>Steven R. Donovan, &quot;The SIP INFO Method&quot;, Internet Draft &lt;draft-ietf-sip-info-method-02.txt&gt;, IETF; February 2000. Work in progress.</P>
<P CLASS="Reference">
<A NAME="pgfId-1029083"></A>[11]	<A NAME="58729"></A>&quot;Signalling System No. 7; ISDN User Part Signalling procedures&quot;, ITU-T Q.764 recommendation, September 1997.</P>
<P CLASS="Reference">
<A NAME="pgfId-1029085"></A>[12]	<A NAME="79089"></A>Abnormal conditions - Special release ITU-T Q.118 recommendation, September 1997.</P>
<P CLASS="Reference">
<A NAME="pgfId-1036077"></A>[13]	<A NAME="15899"></A>&quot;Specifications of Signalling System No. 7 - ISDN supplementary services&quot; ITU-T Q.737 recommendation, June 1997.</P>
<P CLASS="Reference">
<A NAME="pgfId-1036123"></A>[14]	<A NAME="27307"></A>&quot;Specifications of Signalling System No. 7 - ISDN User Part Signalling Procedures&quot; ITU-T Q.764 recommendation, March 1993.</P>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-998279"></A>15.	<A NAME="66958"></A>Security Considerations</H1>
<P CLASS="Body">
<A NAME="pgfId-1028267"></A>The transit of ISUP in SIP bodies may provide may opportunities for abuse and fraud. In particular, SIP users may be able to interpret &quot;private&quot; (i.e. caller-id-blocked) numbers by examining the ISUP. Similarly, if care is not taken, SIP clients would be able to send ISUP messages into the SS7 network with invalid calling line identification and spoofed billing numbers.</P>
<P CLASS="Body">
<A NAME="pgfId-1033352"></A>For these reasons, it is absolutely necessary that any ISUP sent through an IP network be strongly encrypted and authenticated. The keys used for encryption should not be static, to prevent replay attacks. A challenge-response model is recommended. As an extra layer of security, it is recommended that ISUP be sent and received only to and from nodes that are known to have an established trust relationship with the gateway.</P>
</DIV>
<DIV>
<H1 CLASS="Heading1">
<A NAME="pgfId-1028268"></A>16.	Authors' Addresses</H1>
<P><PRE CLASS="Preformat"><A NAME="pgfId-1029031"></A>Gonzalo Camarillo
Ericsson
Advanced Signalling Research Lab
FIN-02420 Jorvas
Finland
Phone: +358 9 299 3371
Fax: +358 9 299 3052
Email: Gonzalo.Camarillo@ericsson.com</PRE>
<PRE CLASS="Preformat"><A NAME="pgfId-1029019"></A>Adam Roach
Ericsson Inc.
Mailstop L-04
851 International Pkwy.
Richardson, TX 75081
USA
Phone: +1 972-583-7594
Fax: +1 972-669-0154
E-Mail: Adam.Roach@ericsson.com</PRE>
</P>
</DIV>
<TABLE NAME="Footer" WIDTH=100%><TR><TD>Camarillo/Roach</TD><TD ALIGN=RIGHT>[Page 44]</TD></TR></TABLE>
</BODY>
</HTML>
